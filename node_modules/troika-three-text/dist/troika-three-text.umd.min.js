'use strict';(function(B,A){"object"===typeof exports&&"undefined"!==typeof module?A(exports,require("three"),require("troika-worker-utils"),require("troika-three-utils")):"function"===typeof define&&define.amd?define(["exports","three","troika-worker-utils","troika-three-utils"],A):(B="undefined"!==typeof globalThis?globalThis:B||self,A(B.troika_three_text={},B.THREE,B.troika_worker_utils,B.troika_three_utils))})(this,function(B,A,J,Y){function Z(r,g){W=!0;r=aa({},r);r.font=ma(r.font||I.defaultFontURL);
r.text=""+r.text;r.sdfGlyphSize=r.sdfGlyphSize||I.sdfGlyphSize;if(null!=r.colorRanges){var b={};for(e in r.colorRanges)if(r.colorRanges.hasOwnProperty(e)){var a=r.colorRanges[e];"number"!==typeof a&&(a=na.set(a).getHex());b[e]=a}r.colorRanges=b}Object.freeze(r);b=I.textureWidth;var c=I.sdfExponent,d=r.sdfGlyphSize;var e=r.font+"@"+d;var f=ba[e];f||(f=ba[e]={sdfTexture:new A.DataTexture(new Uint8Array(d*b),b,d,A.LuminanceFormat,void 0,void 0,void 0,void 0,A.LinearFilter,A.LinearFilter)},f.sdfTexture.font=
r.font);oa(r).then(function(a){a.newGlyphSDFs&&(a.newGlyphSDFs.forEach(function(a){var b=a.textureData,c=a.atlasIndex;for(a=f.sdfTexture.image;a.data.length<(c+1)*d*d;){var e=new Uint8Array(2*a.data.length);e.set(a.data);a.data=e;a.height*=2}e=a.width/d;c=a.width*d*Math.floor(c/e)+c%e*d;for(e=0;e<d;e++)for(var g=e*d,h=c+e*a.width,k=0;k<d;k++)a.data[h+k]=b[g+k]}),f.sdfTexture.needsUpdate=!0);g(Object.freeze({parameters:r,sdfTexture:f.sdfTexture,sdfGlyphSize:d,sdfExponent:c,glyphBounds:a.glyphBounds,
glyphAtlasIndices:a.glyphAtlasIndices,glyphColors:a.glyphColors,caretPositions:a.caretPositions,caretHeight:a.caretHeight,chunkedBounds:a.chunkedBounds,ascender:a.ascender,descender:a.descender,lineHeight:a.lineHeight,topBaseline:a.topBaseline,blockBounds:a.blockBounds,visibleBounds:a.visibleBounds,timings:a.timings,get totalBounds(){console.log("totalBounds deprecated, use blockBounds instead");return a.blockBounds},get totalBlockSize(){console.log("totalBlockSize deprecated, use blockBounds instead");
var b=a.blockBounds;return[b[2]-b[0],b[3]-b[1]]}}))})}function aa(r,g){for(var b in g)g.hasOwnProperty(b)&&(r[b]=g[b]);return r}function ma(r){N||(N="undefined"===typeof document?{}:document.createElement("a"));N.href=r;return N.href}function ca(r){r=Y.createDerivedMaterial(r,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new A.Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new A.Vector4(0,
0,0,0)},uTroikaClipRect:{value:new A.Vector4(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOrient:{value:new A.Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaDistanceOffset;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",
vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nvec4 outlineBounds = vec4(bounds.xy - uTroikaDistanceOffset, bounds.zw + uTroikaDistanceOffset);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerGlyph = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerGlyph * vec2(\n  mod(aTroikaGlyphIndex, txCols),\n  floor(aTroikaGlyphIndex / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerGlyph);\n",
fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaDistanceOffset;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of encoding in SDFGenerator.js\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  return texture2D(uTroikaSDFTexture, textureUV).r;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetTextAlpha(float distanceOffset) {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n    \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n  \n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  float aaDist = length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  float aaDist = vTroikaGlyphDimensions.x / 64.0;\n  #endif\n  \n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n  \n  return alpha;\n}\n",
fragmentColorTransform:"\nfloat alpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetTextAlpha(uTroikaDistanceOffset);\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\ngl_FragColor.a *= alpha;\n#endif\n  \nif (alpha == 0.0) {\n  discard;\n}\n",customRewriter:function(g){var b=g.vertexShader;g=g.fragmentShader;var a=/\buniform\s+vec3\s+diffuse\b/;a.test(g)&&(g=g.replace(a,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),
a.test(b)||(b=b.replace(Y.voidMainRegExp,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n")));return{vertexShader:b,fragmentShader:g}}});r.transparent=!0;Object.defineProperties(r,{isTroikaTextMaterial:{value:!0},shadowSide:{get:function(){return this.side},set:function(){}}});return r}function pa(r){var g=ja.get(r);if(!g){var b=r.caretPositions,a=r.caretHeight;g=new Map;for(var c=0;c<b.length;c+=3){var d=b[c+2],e=g.get(d);e||g.set(d,e=
[]);e.push({x:b[c],y:d,height:a,charIndex:c/3});c+3>=b.length&&e.push({x:b[c+1],y:d,height:a,charIndex:c/3+1})}}ja.set(r,g);return g}var P=J.defineWorkerModule({name:"Typr Font Parser",dependencies:[function(){var r=self,g={parse:function(b){var a=g._bin;b=new Uint8Array(b);if("ttcf"==a.readASCII(b,0,4)){var c=4;a.readUshort(b,c);c+=2;a.readUshort(b,c);c+=2;var d=a.readUint(b,c);c+=4;for(var e=[],f=0;f<d;f++){var h=a.readUint(b,c);c+=4;e.push(g._readFont(b,h))}return e}return[g._readFont(b,0)]},_readFont:function(b,
a){var c=g._bin,d=a;c.readFixed(b,a);a+=4;var e=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;var f="cmap;head;hhea;maxp;hmtx;name;OS/2;post;loca;glyf;kern;CFF ;GPOS;GSUB;SVG ".split(";");d={_data:b,_offset:d};for(var h={},k=0;k<e;k++){var l=c.readASCII(b,a,4);a+=4;c.readUint(b,a);a+=4;var n=c.readUint(b,a);a+=4;var t=c.readUint(b,a);a+=4;h[l]={offset:n,length:t}}for(k=0;k<f.length;k++)a=f[k],h[a]&&(d[a.trim()]=g[a.trim()].parse(b,h[a].offset,h[a].length,
d));return d},_tabOffset:function(b,a,c){var d=g._bin,e=d.readUshort(b,c+4);c+=12;for(var f=0;f<e;f++){var h=d.readASCII(b,c,4);c+=4;d.readUint(b,c);c+=4;var k=d.readUint(b,c);c+=4;d.readUint(b,c);c+=4;if(h==a)return k}return 0}};g._bin={readFixed:function(b,a){return(b[a]<<8|b[a+1])+(b[a+2]<<8|b[a+3])/65540},readF2dot14:function(b,a){return g._bin.readShort(b,a)/16384},readInt:function(b,a){var c=g._bin.t.uint8;c[0]=b[a+3];c[1]=b[a+2];c[2]=b[a+1];c[3]=b[a];return g._bin.t.int32[0]},readInt8:function(b,
a){g._bin.t.uint8[0]=b[a];return g._bin.t.int8[0]},readShort:function(b,a){var c=g._bin.t.uint8;c[1]=b[a];c[0]=b[a+1];return g._bin.t.int16[0]},readUshort:function(b,a){return b[a]<<8|b[a+1]},readUshorts:function(b,a,c){for(var d=[],e=0;e<c;e++)d.push(g._bin.readUshort(b,a+2*e));return d},readUint:function(b,a){var c=g._bin.t.uint8;c[3]=b[a];c[2]=b[a+1];c[1]=b[a+2];c[0]=b[a+3];return g._bin.t.uint32[0]},readUint64:function(b,a){return 4294967296*g._bin.readUint(b,a)+g._bin.readUint(b,a+4)},readASCII:function(b,
a,c){for(var d="",e=0;e<c;e++)d+=String.fromCharCode(b[a+e]);return d},readUnicode:function(b,a,c){for(var d="",e=0;e<c;e++){var f=b[a++]<<8|b[a++];d+=String.fromCharCode(f)}return d},_tdec:r.TextDecoder?new r.TextDecoder:null,readUTF8:function(b,a,c){var d=g._bin._tdec;return d&&0==a&&c==b.length?d.decode(b):g._bin.readASCII(b,a,c)},readBytes:function(b,a,c){for(var d=[],e=0;e<c;e++)d.push(b[a+e]);return d},readASCIIArray:function(b,a,c){for(var d=[],e=0;e<c;e++)d.push(String.fromCharCode(b[a+e]));
return d}};g._bin.t={buff:new ArrayBuffer(8)};g._bin.t.int8=new Int8Array(g._bin.t.buff);g._bin.t.uint8=new Uint8Array(g._bin.t.buff);g._bin.t.int16=new Int16Array(g._bin.t.buff);g._bin.t.uint16=new Uint16Array(g._bin.t.buff);g._bin.t.int32=new Int32Array(g._bin.t.buff);g._bin.t.uint32=new Uint32Array(g._bin.t.buff);g._lctf={};g._lctf.parse=function(b,a,c,d,e){var f=g._bin;c={};d=a;f.readFixed(b,a);a+=4;var h=f.readUshort(b,a);a+=2;var k=f.readUshort(b,a);a=f.readUshort(b,a+2);c.scriptList=g._lctf.readScriptList(b,
d+h);c.featureList=g._lctf.readFeatureList(b,d+k);c.lookupList=g._lctf.readLookupList(b,d+a,e);return c};g._lctf.readLookupList=function(b,a,c){var d=g._bin,e=a,f=[],h=d.readUshort(b,a);a+=2;for(var k=0;k<h;k++){var l=d.readUshort(b,a);a+=2;l=g._lctf.readLookupTable(b,e+l,c);f.push(l)}return f};g._lctf.readLookupTable=function(b,a,c){var d=g._bin,e=a,f={tabs:[]};f.ltype=d.readUshort(b,a);a+=2;f.flag=d.readUshort(b,a);a+=2;var h=d.readUshort(b,a);a+=2;for(var k=0;k<h;k++){var l=d.readUshort(b,a);a+=
2;l=c(b,f.ltype,e+l);f.tabs.push(l)}return f};g._lctf.numOfOnes=function(b){for(var a=0,c=0;32>c;c++)0!=(b>>>c&1)&&a++;return a};g._lctf.readClassDef=function(b,a){var c=g._bin,d=[],e=c.readUshort(b,a);a+=2;if(1==e){var f=c.readUshort(b,a);a+=2;var h=c.readUshort(b,a);a+=2;for(var k=0;k<h;k++)d.push(f+k),d.push(f+k),d.push(c.readUshort(b,a)),a+=2}if(2==e)for(e=c.readUshort(b,a),a+=2,k=0;k<e;k++)d.push(c.readUshort(b,a)),a+=2,d.push(c.readUshort(b,a)),a+=2,d.push(c.readUshort(b,a)),a+=2;return d};
g._lctf.getInterval=function(b,a){for(var c=0;c<b.length;c+=3){var d=b[c+1];if(b[c]<=a&&a<=d)return c}return-1};g._lctf.readCoverage=function(b,a){var c=g._bin,d={};d.fmt=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;1==d.fmt&&(d.tab=c.readUshorts(b,a,e));2==d.fmt&&(d.tab=c.readUshorts(b,a,3*e));return d};g._lctf.coverageIndex=function(b,a){var c=b.tab;return 1==b.fmt?c.indexOf(a):2==b.fmt&&(b=g._lctf.getInterval(c,a),-1!=b)?c[b+2]+(a-c[b]):-1};g._lctf.readFeatureList=function(b,a){var c=g._bin,
d=a,e=[],f=c.readUshort(b,a);a+=2;for(var h=0;h<f;h++){var k=c.readASCII(b,a,4);a+=4;var l=c.readUshort(b,a);a+=2;e.push({tag:k.trim(),tab:g._lctf.readFeatureTable(b,d+l)})}return e};g._lctf.readFeatureTable=function(b,a){var c=g._bin;c.readUshort(b,a);a+=2;var d=c.readUshort(b,a);a+=2;for(var e=[],f=0;f<d;f++)e.push(c.readUshort(b,a+2*f));return e};g._lctf.readScriptList=function(b,a){var c=g._bin,d=a,e={},f=c.readUshort(b,a);a+=2;for(var h=0;h<f;h++){var k=c.readASCII(b,a,4);a+=4;var l=c.readUshort(b,
a);a+=2;e[k.trim()]=g._lctf.readScriptTable(b,d+l)}return e};g._lctf.readScriptTable=function(b,a){var c=g._bin,d=a,e={},f=c.readUshort(b,a);a+=2;e.default=g._lctf.readLangSysTable(b,d+f);f=c.readUshort(b,a);a+=2;for(var h=0;h<f;h++){var k=c.readASCII(b,a,4);a+=4;var l=c.readUshort(b,a);a+=2;e[k.trim()]=g._lctf.readLangSysTable(b,d+l)}return e};g._lctf.readLangSysTable=function(b,a){var c=g._bin,d={};c.readUshort(b,a);a+=2;d.reqFeature=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);d.features=c.readUshorts(b,
a+2,e);return d};g.CFF={};g.CFF.parse=function(b,a,c){var d=g._bin;b=new Uint8Array(b.buffer,a,c);a=0;a++;a++;a++;a++;var e=[];a=g.CFF.readIndex(b,a,e);var f=[];for(c=0;c<e.length-1;c++)f.push(d.readASCII(b,a+e[c],e[c+1]-e[c]));a+=e[e.length-1];e=[];a=g.CFF.readIndex(b,a,e);f=[];for(c=0;c<e.length-1;c++)f.push(g.CFF.readDict(b,a+e[c],a+e[c+1]));a+=e[e.length-1];e=f[0];var h=[];a=g.CFF.readIndex(b,a,h);f=[];for(c=0;c<h.length-1;c++)f.push(d.readASCII(b,a+h[c],h[c+1]-h[c]));a+=h[h.length-1];g.CFF.readSubrs(b,
a,e);if(e.CharStrings){a=e.CharStrings;h=[];a=g.CFF.readIndex(b,a,h);var k=[];for(c=0;c<h.length-1;c++)k.push(d.readBytes(b,a+h[c],h[c+1]-h[c]));e.CharStrings=k}if(e.ROS){a=e.FDArray;h=[];a=g.CFF.readIndex(b,a,h);e.FDArray=[];for(c=0;c<h.length-1;c++)k=g.CFF.readDict(b,a+h[c],a+h[c+1]),g.CFF._readFDict(b,k,f),e.FDArray.push(k);a=e.FDSelect;e.FDSelect=[];c=b[a];a++;if(3==c)for(h=d.readUshort(b,a),a+=2,c=0;c<h+1;c++)e.FDSelect.push(d.readUshort(b,a),b[a+2]),a+=3;else throw c;}e.Encoding&&(e.Encoding=
g.CFF.readEncoding(b,e.Encoding,e.CharStrings.length));e.charset&&(e.charset=g.CFF.readCharset(b,e.charset,e.CharStrings.length));g.CFF._readFDict(b,e,f);return e};g.CFF._readFDict=function(b,a,c){if(a.Private){var d=a.Private[1];a.Private=g.CFF.readDict(b,d,d+a.Private[0]);a.Private.Subrs&&g.CFF.readSubrs(b,d+a.Private.Subrs,a.Private)}for(var e in a)-1!="FamilyName FontName FullName Notice version Copyright".split(" ").indexOf(e)&&(a[e]=c[a[e]-426+35])};g.CFF.readSubrs=function(b,a,c){var d=g._bin,
e=[];a=g.CFF.readIndex(b,a,e);var f=e.length;c.Bias=1240>f?107:33900>f?1131:32768;c.Subrs=[];for(f=0;f<e.length-1;f++)c.Subrs.push(d.readBytes(b,a+e[f],e[f+1]-e[f]))};g.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,
89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0];g.CFF.glyphByUnicode=function(b,a){for(var c=0;c<b.charset.length;c++)if(b.charset[c]==a)return c;return-1};g.CFF.glyphBySE=
function(b,a){return 0>a||255<a?-1:g.CFF.glyphByUnicode(b,g.CFF.tableSE[a])};g.CFF.readEncoding=function(b,a,c){c=[".notdef"];var d=b[a];a++;if(0==d){d=b[a];a++;for(var e=0;e<d;e++)c.push(b[a+e])}else throw"error: unknown encoding format: "+d;return c};g.CFF.readCharset=function(b,a,c){var d=g._bin,e=[".notdef"],f=b[a];a++;if(0==f)for(var h=0;h<c;h++){var k=d.readUshort(b,a);a+=2;e.push(k)}else if(1==f||2==f)for(;e.length<c;){k=d.readUshort(b,a);a+=2;if(1==f){var l=b[a];a++}else l=d.readUshort(b,
a),a+=2;for(h=0;h<=l;h++)e.push(k),k++}else throw"error: format: "+f;return e};g.CFF.readIndex=function(b,a,c){var d=g._bin,e=d.readUshort(b,a)+1;a+=2;var f=b[a];a++;if(1==f)for(var h=0;h<e;h++)c.push(b[a+h]);else if(2==f)for(h=0;h<e;h++)c.push(d.readUshort(b,a+2*h));else if(3==f)for(h=0;h<e;h++)c.push(d.readUint(b,a+3*h-1)&16777215);else if(1!=e)throw"unsupported offset size: "+f+", count: "+e;return a+e*f-1};g.CFF.getCharString=function(b,a,c){var d=g._bin,e=b[a],f=b[a+1],h=1,k=null,l=null;20>=
e&&(k=e,h=1);12==e&&(k=100*e+f,h=2);21<=e&&27>=e&&(k=e,h=1);28==e&&(l=d.readShort(b,a+1),h=3);29<=e&&31>=e&&(k=e,h=1);32<=e&&246>=e&&(l=e-139,h=1);247<=e&&250>=e&&(l=256*(e-247)+f+108,h=2);251<=e&&254>=e&&(l=256*-(e-251)-f-108,h=2);255==e&&(l=d.readInt(b,a+1)/65535,h=5);c.val=null!=l?l:"o"+k;c.size=h};g.CFF.readCharString=function(b,a,c){c=a+c;for(var d=g._bin,e=[];a<c;){var f=b[a],h=b[a+1],k=1,l=null,n=null;20>=f&&(l=f,k=1);12==f&&(l=100*f+h,k=2);if(19==f||20==f)l=f,k=2;21<=f&&27>=f&&(l=f,k=1);28==
f&&(n=d.readShort(b,a+1),k=3);29<=f&&31>=f&&(l=f,k=1);32<=f&&246>=f&&(n=f-139,k=1);247<=f&&250>=f&&(n=256*(f-247)+h+108,k=2);251<=f&&254>=f&&(n=256*-(f-251)-h-108,k=2);255==f&&(n=d.readInt(b,a+1)/65535,k=5);e.push(null!=n?n:"o"+l);a+=k}return e};g.CFF.readDict=function(b,a,c){for(var d=g._bin,e={},f=[];a<c;){var h=b[a],k=b[a+1],l=1,n=null,t=null;28==h&&(t=d.readShort(b,a+1),l=3);29==h&&(t=d.readInt(b,a+1),l=5);32<=h&&246>=h&&(t=h-139,l=1);247<=h&&250>=h&&(t=256*(h-247)+k+108,l=2);251<=h&&254>=h&&
(t=256*-(h-251)-k-108,l=2);if(255==h)throw d.readInt(b,a+1),"unknown number";if(30==h){t=[];for(l=1;;){var m=b[a+l];l++;var p=m>>4;m&=15;15!=p&&t.push(p);15!=m&&t.push(m);if(15==m)break}p="";m=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"];for(var q=0;q<t.length;q++)p+=m[t[q]];t=parseFloat(p)}21>=h&&(l="version Notice FullName FamilyName Weight FontBBox BlueValues OtherBlues FamilyBlues FamilyOtherBlues StdHW StdVW escape UniqueID XUID charset Encoding CharStrings Private Subrs defaultWidthX nominalWidthX".split(" "),
n=l[h],l=1,12==h&&(l=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"],n=l[k],l=2));null!=n?(e[n]=1==f.length?
f[0]:f,f=[]):f.push(t);a+=l}return e};g.cmap={};g.cmap.parse=function(b,a,c){b=new Uint8Array(b.buffer,a,c);a=0;c=g._bin;var d={};c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;var f=[];d.tables=[];for(var h=0;h<e;h++){var k=c.readUshort(b,a);a+=2;var l=c.readUshort(b,a);a+=2;var n=c.readUint(b,a);a+=4;var t="p"+k+"e"+l,m=f.indexOf(n);if(-1==m){m=d.tables.length;var p;f.push(n);var q=c.readUshort(b,n);0==q?p=g.cmap.parse0(b,n):4==q?p=g.cmap.parse4(b,n):6==q?p=g.cmap.parse6(b,n):12==q?p=g.cmap.parse12(b,
n):console.log("unknown format: "+q,k,l,n);d.tables.push(p)}if(null!=d[t])throw"multiple tables for one platform+encoding";d[t]=m}return d};g.cmap.parse0=function(b,a){var c=g._bin,d={};d.format=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;d.map=[];for(c=0;c<e-6;c++)d.map.push(b[a+c]);return d};g.cmap.parse4=function(b,a){var c=g._bin,d=a,e={};e.format=c.readUshort(b,a);a+=2;var f=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;var h=c.readUshort(b,a);a+=2;h/=2;e.searchRange=
c.readUshort(b,a);a+=2;e.entrySelector=c.readUshort(b,a);a+=2;e.rangeShift=c.readUshort(b,a);a+=2;e.endCount=c.readUshorts(b,a,h);a=a+2*h+2;e.startCount=c.readUshorts(b,a,h);a+=2*h;e.idDelta=[];for(var k=0;k<h;k++)e.idDelta.push(c.readShort(b,a)),a+=2;e.idRangeOffset=c.readUshorts(b,a,h);a+=2*h;for(e.glyphIdArray=[];a<d+f;)e.glyphIdArray.push(c.readUshort(b,a)),a+=2;return e};g.cmap.parse6=function(b,a){var c=g._bin,d={};d.format=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=
2;d.firstCode=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;d.glyphIdArray=[];for(var f=0;f<e;f++)d.glyphIdArray.push(c.readUshort(b,a)),a+=2;return d};g.cmap.parse12=function(b,a){var c=g._bin,d={};d.format=c.readUshort(b,a);a=a+2+2;c.readUint(b,a);a+=4;c.readUint(b,a);a+=4;var e=c.readUint(b,a);a+=4;d.groups=[];for(var f=0;f<e;f++){var h=a+12*f,k=c.readUint(b,h+0),l=c.readUint(b,h+4);h=c.readUint(b,h+8);d.groups.push([k,l,h])}return d};g.glyf={};g.glyf.parse=function(b,a,c,d){b=[];for(a=0;a<
d.maxp.numGlyphs;a++)b.push(null);return b};g.glyf._parseGlyf=function(b,a){var c=g._bin,d=b._data,e=g._tabOffset(d,"glyf",b._offset)+b.loca[a];if(b.loca[a]==b.loca[a+1])return null;b={};b.noc=c.readShort(d,e);e+=2;b.xMin=c.readShort(d,e);e+=2;b.yMin=c.readShort(d,e);e+=2;b.xMax=c.readShort(d,e);e+=2;b.yMax=c.readShort(d,e);e+=2;if(b.xMin>=b.xMax||b.yMin>=b.yMax)return null;if(0<b.noc){b.endPts=[];for(a=0;a<b.noc;a++)b.endPts.push(c.readUshort(d,e)),e+=2;a=c.readUshort(d,e);e+=2;if(d.length-e<a)return null;
b.instructions=c.readBytes(d,e,a);e+=a;var f=b.endPts[b.noc-1]+1;b.flags=[];for(a=0;a<f;a++){var h=d[e];e++;b.flags.push(h);if(0!=(h&8)){var k=d[e];e++;for(var l=0;l<k;l++)b.flags.push(h),a++}}b.xs=[];for(a=0;a<f;a++)h=0!=(b.flags[a]&2),k=0!=(b.flags[a]&16),h?(b.xs.push(k?d[e]:-d[e]),e++):k?b.xs.push(0):(b.xs.push(c.readShort(d,e)),e+=2);b.ys=[];for(a=0;a<f;a++)h=0!=(b.flags[a]&4),k=0!=(b.flags[a]&32),h?(b.ys.push(k?d[e]:-d[e]),e++):k?b.ys.push(0):(b.ys.push(c.readShort(d,e)),e+=2);for(a=e=d=0;a<
f;a++)d+=b.xs[a],e+=b.ys[a],b.xs[a]=d,b.ys[a]=e}else{b.parts=[];do a=c.readUshort(d,e),e+=2,f={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1},b.parts.push(f),f.glyphIndex=c.readUshort(d,e),e+=2,a&1?(h=c.readShort(d,e),e+=2,k=c.readShort(d,e),e+=2):(h=c.readInt8(d,e),e++,k=c.readInt8(d,e),e++),a&2?(f.m.tx=h,f.m.ty=k):(f.p1=h,f.p2=k),a&8?(f.m.a=f.m.d=c.readF2dot14(d,e),e+=2):a&64?(f.m.a=c.readF2dot14(d,e),e+=2,f.m.d=c.readF2dot14(d,e),e+=2):a&128&&(f.m.a=c.readF2dot14(d,e),e+=2,f.m.b=c.readF2dot14(d,e),
e+=2,f.m.c=c.readF2dot14(d,e),e+=2,f.m.d=c.readF2dot14(d,e),e+=2);while(a&32);if(a&256)for(c=c.readUshort(d,e),e+=2,b.instr=[],a=0;a<c;a++)b.instr.push(d[e]),e++}return b};g.GPOS={};g.GPOS.parse=function(b,a,c,d){return g._lctf.parse(b,a,c,d,g.GPOS.subt)};g.GPOS.subt=function(b,a,c){var d=g._bin,e=c,f={};f.fmt=d.readUshort(b,c);c+=2;if(1==a||2==a||3==a||7==a||8==a&&2>=f.fmt){var h=d.readUshort(b,c);c+=2;f.coverage=g._lctf.readCoverage(b,h+e)}if(1==a&&1==f.fmt){var k=d.readUshort(b,c);c+=2;g._lctf.numOfOnes(k);
0!=k&&(f.pos=g.GPOS.readValueRecord(b,c,k))}else if(2==a){k=d.readUshort(b,c);c+=2;var l=d.readUshort(b,c);c+=2;a=g._lctf.numOfOnes(k);h=g._lctf.numOfOnes(l);if(1==f.fmt){f.pairsets=[];var n=d.readUshort(b,c);c+=2;for(var t=0;t<n;t++){var m=e+d.readUshort(b,c);c+=2;var p=d.readUshort(b,m);m+=2;for(var q=[],u=0;u<p;u++){var v=d.readUshort(b,m);m+=2;if(0!=k){var w=g.GPOS.readValueRecord(b,m,k);m+=2*a}if(0!=l){var x=g.GPOS.readValueRecord(b,m,l);m+=2*h}q.push({gid2:v,val1:w,val2:x})}f.pairsets.push(q)}}if(2==
f.fmt)for(w=d.readUshort(b,c),c+=2,x=d.readUshort(b,c),c+=2,k=d.readUshort(b,c),c+=2,d=d.readUshort(b,c),c+=2,f.classDef1=g._lctf.readClassDef(b,e+w),f.classDef2=g._lctf.readClassDef(b,e+x),f.matrix=[],t=0;t<k;t++){e=[];for(u=0;u<d;u++)x=w=null,0!=f.valFmt1&&(w=g.GPOS.readValueRecord(b,c,f.valFmt1),c+=2*a),0!=f.valFmt2&&(x=g.GPOS.readValueRecord(b,c,f.valFmt2),c+=2*h),e.push({val1:w,val2:x});f.matrix.push(e)}}return f};g.GPOS.readValueRecord=function(b,a,c){var d=g._bin,e=[];e.push(c&1?d.readShort(b,
a):0);a+=c&1?2:0;e.push(c&2?d.readShort(b,a):0);a+=c&2?2:0;e.push(c&4?d.readShort(b,a):0);e.push(c&8?d.readShort(b,a+(c&4?2:0)):0);return e};g.GSUB={};g.GSUB.parse=function(b,a,c,d){return g._lctf.parse(b,a,c,d,g.GSUB.subt)};g.GSUB.subt=function(b,a,c){var d=g._bin,e=c,f={};f.fmt=d.readUshort(b,c);c+=2;if(1!=a&&4!=a&&5!=a&&6!=a)return null;if(1==a||4==a||5==a&&2>=f.fmt||6==a&&2>=f.fmt){var h=d.readUshort(b,c);c+=2;f.coverage=g._lctf.readCoverage(b,e+h)}if(1==a)1==f.fmt?f.delta=d.readShort(b,c):2==
f.fmt&&(h=d.readUshort(b,c),f.newg=d.readUshorts(b,c+2,h));else if(4==a)for(f.vals=[],h=d.readUshort(b,c),c+=2,a=0;a<h;a++){var k=d.readUshort(b,c);c+=2;f.vals.push(g.GSUB.readLigatureSet(b,e+k))}else if(5==a){if(2==f.fmt)for(a=d.readUshort(b,c),c+=2,f.cDef=g._lctf.readClassDef(b,e+a),f.scset=[],h=d.readUshort(b,c),c+=2,a=0;a<h;a++)k=d.readUshort(b,c),c+=2,f.scset.push(0==k?null:g.GSUB.readSubClassSet(b,e+k))}else if(6==a&&3==f.fmt){for(a=0;3>a;a++){h=d.readUshort(b,c);c+=2;k=[];for(var l=0;l<h;l++)k.push(g._lctf.readCoverage(b,
e+d.readUshort(b,c+2*l)));c+=2*h;0==a&&(f.backCvg=k);1==a&&(f.inptCvg=k);2==a&&(f.ahedCvg=k)}h=d.readUshort(b,c);f.lookupRec=g.GSUB.readSubstLookupRecords(b,c+2,h)}return f};g.GSUB.readSubClassSet=function(b,a){var c=g._bin.readUshort,d=a,e=[],f=c(b,a);a+=2;for(var h=0;h<f;h++){var k=c(b,a);a+=2;e.push(g.GSUB.readSubClassRule(b,d+k))}return e};g.GSUB.readSubClassRule=function(b,a){var c=g._bin.readUshort,d={},e=c(b,a);a+=2;var f=c(b,a);a+=2;d.input=[];for(var h=0;h<e-1;h++)d.input.push(c(b,a)),a+=
2;d.substLookupRecords=g.GSUB.readSubstLookupRecords(b,a,f);return d};g.GSUB.readSubstLookupRecords=function(b,a,c){for(var d=g._bin.readUshort,e=[],f=0;f<c;f++)e.push(d(b,a),d(b,a+2)),a+=4;return e};g.GSUB.readChainSubClassSet=function(b,a){var c=g._bin,d=a,e=[],f=c.readUshort(b,a);a+=2;for(var h=0;h<f;h++){var k=c.readUshort(b,a);a+=2;e.push(g.GSUB.readChainSubClassRule(b,d+k))}return e};g.GSUB.readChainSubClassRule=function(b,a){for(var c=g._bin,d={},e=["backtrack","input","lookahead"],f=0;f<e.length;f++){var h=
c.readUshort(b,a);a+=2;1==f&&h--;d[e[f]]=c.readUshorts(b,a,h);a+=2*d[e[f]].length}h=c.readUshort(b,a);d.subst=c.readUshorts(b,a+2,2*h);return d};g.GSUB.readLigatureSet=function(b,a){var c=g._bin,d=a,e=[],f=c.readUshort(b,a);a+=2;for(var h=0;h<f;h++){var k=c.readUshort(b,a);a+=2;e.push(g.GSUB.readLigature(b,d+k))}return e};g.GSUB.readLigature=function(b,a){var c=g._bin,d={chain:[]};d.nglyph=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;for(var f=0;f<e-1;f++)d.chain.push(c.readUshort(b,a)),a+=
2;return d};g.head={};g.head.parse=function(b,a,c){c=g._bin;var d={};c.readFixed(b,a);a+=4;d.fontRevision=c.readFixed(b,a);a+=4;c.readUint(b,a);a+=4;c.readUint(b,a);a+=4;d.flags=c.readUshort(b,a);a+=2;d.unitsPerEm=c.readUshort(b,a);a+=2;d.created=c.readUint64(b,a);a+=8;d.modified=c.readUint64(b,a);a+=8;d.xMin=c.readShort(b,a);a+=2;d.yMin=c.readShort(b,a);a+=2;d.xMax=c.readShort(b,a);a+=2;d.yMax=c.readShort(b,a);a+=2;d.macStyle=c.readUshort(b,a);a+=2;d.lowestRecPPEM=c.readUshort(b,a);a+=2;d.fontDirectionHint=
c.readShort(b,a);a+=2;d.indexToLocFormat=c.readShort(b,a);d.glyphDataFormat=c.readShort(b,a+2);return d};g.hhea={};g.hhea.parse=function(b,a,c){c=g._bin;var d={};c.readFixed(b,a);a+=4;d.ascender=c.readShort(b,a);a+=2;d.descender=c.readShort(b,a);a+=2;d.lineGap=c.readShort(b,a);a+=2;d.advanceWidthMax=c.readUshort(b,a);a+=2;d.minLeftSideBearing=c.readShort(b,a);a+=2;d.minRightSideBearing=c.readShort(b,a);a+=2;d.xMaxExtent=c.readShort(b,a);a+=2;d.caretSlopeRise=c.readShort(b,a);a+=2;d.caretSlopeRun=
c.readShort(b,a);a+=2;d.caretOffset=c.readShort(b,a);a=a+2+8;d.metricDataFormat=c.readShort(b,a);d.numberOfHMetrics=c.readUshort(b,a+2);return d};g.hmtx={};g.hmtx.parse=function(b,a,c,d){c=g._bin;for(var e={aWidth:[],lsBearing:[]},f=0,h=0,k=0;k<d.maxp.numGlyphs;k++)k<d.hhea.numberOfHMetrics&&(f=c.readUshort(b,a),a+=2,h=c.readShort(b,a),a+=2),e.aWidth.push(f),e.lsBearing.push(h);return e};g.kern={};g.kern.parse=function(b,a,c,d){var e=g._bin,f=e.readUshort(b,a);a+=2;if(1==f)return g.kern.parseV1(b,
a-2,c,d);c=e.readUshort(b,a);a+=2;d={glyph1:[],rval:[]};for(f=0;f<c;f++){a+=2;e.readUshort(b,a);a+=2;var h=e.readUshort(b,a);a+=2;h>>>=8;h&=15;if(0==h)a=g.kern.readFormat0(b,a,d);else throw"unknown kern table format: "+h;}return d};g.kern.parseV1=function(b,a,c,d){c=g._bin;c.readFixed(b,a);a+=4;d=c.readUint(b,a);a+=4;for(var e={glyph1:[],rval:[]},f=0;f<d;f++){c.readUint(b,a);a+=4;var h=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;h>>>=8;h&=15;if(0==h)a=g.kern.readFormat0(b,a,e);else throw"unknown kern table format: "+
h;}return e};g.kern.readFormat0=function(b,a,c){var d=g._bin,e=-1,f=d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;for(var h=0;h<f;h++){var k=d.readUshort(b,a);a+=2;var l=d.readUshort(b,a);a+=2;var n=d.readShort(b,a);a+=2;k!=e&&(c.glyph1.push(k),c.rval.push({glyph2:[],vals:[]}));e=c.rval[c.rval.length-1];e.glyph2.push(l);e.vals.push(n);e=k}return a};g.loca={};g.loca.parse=function(b,a,c,d){c=g._bin;var e=[],f=d.head.indexToLocFormat;d=d.maxp.numGlyphs+
1;if(0==f)for(var h=0;h<d;h++)e.push(c.readUshort(b,a+(h<<1))<<1);if(1==f)for(h=0;h<d;h++)e.push(c.readUint(b,a+(h<<2)));return e};g.maxp={};g.maxp.parse=function(b,a,c){c=g._bin;var d={},e=c.readUint(b,a);a+=4;d.numGlyphs=c.readUshort(b,a);a+=2;65536==e&&(d.maxPoints=c.readUshort(b,a),a+=2,d.maxContours=c.readUshort(b,a),a+=2,d.maxCompositePoints=c.readUshort(b,a),a+=2,d.maxCompositeContours=c.readUshort(b,a),a+=2,d.maxZones=c.readUshort(b,a),a+=2,d.maxTwilightPoints=c.readUshort(b,a),a+=2,d.maxStorage=
c.readUshort(b,a),a+=2,d.maxFunctionDefs=c.readUshort(b,a),a+=2,d.maxInstructionDefs=c.readUshort(b,a),a+=2,d.maxStackElements=c.readUshort(b,a),a+=2,d.maxSizeOfInstructions=c.readUshort(b,a),a+=2,d.maxComponentElements=c.readUshort(b,a),d.maxComponentDepth=c.readUshort(b,a+2));return d};g.name={};g.name.parse=function(b,a,c){c=g._bin;var d={};c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;for(var f="copyright fontFamily fontSubfamily ID fullName version postScriptName trademark manufacturer designer description urlVendor urlDesigner licence licenceURL --- typoFamilyName typoSubfamilyName compatibleFull sampleText postScriptCID wwsFamilyName wwsSubfamilyName lightPalette darkPalette".split(" "),
h=a,k=0;k<e;k++){var l=c.readUshort(b,a);a+=2;var n=c.readUshort(b,a);a+=2;var t=c.readUshort(b,a);a+=2;var m=c.readUshort(b,a);a+=2;var p=c.readUshort(b,a);a+=2;var q=c.readUshort(b,a);a+=2;m=f[m];q=h+12*e+q;if(0==l)p=c.readUnicode(b,q,p/2);else if(3==l&&0==n)p=c.readUnicode(b,q,p/2);else if(0==n)p=c.readASCII(b,q,p);else if(1==n)p=c.readUnicode(b,q,p/2);else if(3==n)p=c.readUnicode(b,q,p/2);else if(1==l)p=c.readASCII(b,q,p),console.log("reading unknown MAC encoding "+n+" as ASCII");else throw"unknown encoding "+
n+", platformID: "+l;l="p"+l+","+t.toString(16);null==d[l]&&(d[l]={});d[l][m]=p;d[l]._lang=t}for(var u in d)if(null!=d[u].postScriptName&&1033==d[u]._lang)return d[u];for(u in d)if(null!=d[u].postScriptName&&0==d[u]._lang)return d[u];for(u in d)if(null!=d[u].postScriptName&&3084==d[u]._lang)return d[u];for(u in d)if(null!=d[u].postScriptName)return d[u];for(u in d){var v=u;break}console.log("returning name table with languageID "+d[v]._lang);return d[v]};g["OS/2"]={};g["OS/2"].parse=function(b,a,
c){c=g._bin.readUshort(b,a);a+=2;var d={};if(0==c)g["OS/2"].version0(b,a,d);else if(1==c)g["OS/2"].version1(b,a,d);else if(2==c||3==c||4==c)g["OS/2"].version2(b,a,d);else if(5==c)g["OS/2"].version5(b,a,d);else throw"unknown OS/2 table version: "+c;return d};g["OS/2"].version0=function(b,a,c){var d=g._bin;c.xAvgCharWidth=d.readShort(b,a);a+=2;c.usWeightClass=d.readUshort(b,a);a+=2;c.usWidthClass=d.readUshort(b,a);a+=2;c.fsType=d.readUshort(b,a);a+=2;c.ySubscriptXSize=d.readShort(b,a);a+=2;c.ySubscriptYSize=
d.readShort(b,a);a+=2;c.ySubscriptXOffset=d.readShort(b,a);a+=2;c.ySubscriptYOffset=d.readShort(b,a);a+=2;c.ySuperscriptXSize=d.readShort(b,a);a+=2;c.ySuperscriptYSize=d.readShort(b,a);a+=2;c.ySuperscriptXOffset=d.readShort(b,a);a+=2;c.ySuperscriptYOffset=d.readShort(b,a);a+=2;c.yStrikeoutSize=d.readShort(b,a);a+=2;c.yStrikeoutPosition=d.readShort(b,a);a+=2;c.sFamilyClass=d.readShort(b,a);a+=2;c.panose=d.readBytes(b,a,10);a+=10;c.ulUnicodeRange1=d.readUint(b,a);a+=4;c.ulUnicodeRange2=d.readUint(b,
a);a+=4;c.ulUnicodeRange3=d.readUint(b,a);a+=4;c.ulUnicodeRange4=d.readUint(b,a);a+=4;c.achVendID=[d.readInt8(b,a),d.readInt8(b,a+1),d.readInt8(b,a+2),d.readInt8(b,a+3)];a+=4;c.fsSelection=d.readUshort(b,a);a+=2;c.usFirstCharIndex=d.readUshort(b,a);a+=2;c.usLastCharIndex=d.readUshort(b,a);a+=2;c.sTypoAscender=d.readShort(b,a);a+=2;c.sTypoDescender=d.readShort(b,a);a+=2;c.sTypoLineGap=d.readShort(b,a);a+=2;c.usWinAscent=d.readUshort(b,a);a+=2;c.usWinDescent=d.readUshort(b,a);return a+2};g["OS/2"].version1=
function(b,a,c){var d=g._bin;a=g["OS/2"].version0(b,a,c);c.ulCodePageRange1=d.readUint(b,a);a+=4;c.ulCodePageRange2=d.readUint(b,a);return a+4};g["OS/2"].version2=function(b,a,c){var d=g._bin;a=g["OS/2"].version1(b,a,c);c.sxHeight=d.readShort(b,a);a+=2;c.sCapHeight=d.readShort(b,a);a+=2;c.usDefault=d.readUshort(b,a);a+=2;c.usBreak=d.readUshort(b,a);a+=2;c.usMaxContext=d.readUshort(b,a);return a+2};g["OS/2"].version5=function(b,a,c){var d=g._bin;a=g["OS/2"].version2(b,a,c);c.usLowerOpticalPointSize=
d.readUshort(b,a);a+=2;c.usUpperOpticalPointSize=d.readUshort(b,a);return a+2};g.post={};g.post.parse=function(b,a,c){c=g._bin;var d={};d.version=c.readFixed(b,a);a+=4;d.italicAngle=c.readFixed(b,a);a+=4;d.underlinePosition=c.readShort(b,a);d.underlineThickness=c.readShort(b,a+2);return d};g.SVG={};g.SVG.parse=function(b,a,c){c=g._bin;var d={entries:[]},e=a;c.readUshort(b,a);a+=2;var f=c.readUint(b,a);c.readUint(b,a+4);a=f+e;var h=c.readUshort(b,a);a+=2;for(var k=0;k<h;k++){var l=c.readUshort(b,a);
a+=2;var n=c.readUshort(b,a);a+=2;var t=c.readUint(b,a);a+=4;var m=c.readUint(b,a);a+=4;t=new Uint8Array(b.buffer,e+t+f,m);for(t=c.readUTF8(t,0,t.length);l<=n;l++)d.entries[l]=t}return d};g.SVG.toPath=function(b){var a={cmds:[],crds:[]};if(null==b)return a;for(var c=(new DOMParser).parseFromString(b,"image/svg+xml").firstChild;"svg"!=c.tagName;)c=c.nextSibling;b=(b=c.getAttribute("viewBox"))?b.trim().split(" ").map(parseFloat):[0,0,1E3,1E3];g.SVG._toPath(c.children,a);for(c=0;c<a.crds.length;c+=2){var d=
a.crds[c],e=a.crds[c+1];d-=b[0];e-=b[1];e=-e;a.crds[c]=d;a.crds[c+1]=e}return a};g.SVG._toPath=function(b,a,c){for(var d=0;d<b.length;d++){var e=b[d],f=e.tagName,h=e.getAttribute("fill");null==h&&(h=c);"g"==f?g.SVG._toPath(e.children,a,h):"path"==f?(a.cmds.push(h?h:"#000000"),e=e.getAttribute("d"),e=g.SVG._tokens(e),g.SVG._toksToPath(e,a),a.cmds.push("X")):"defs"!=f&&console.log(f,e)}};g.SVG._tokens=function(b){for(var a=[],c=0,d=!1,e="";c<b.length;){var f=b.charCodeAt(c),g=b.charAt(c);c++;f=48<=
f&&57>=f||"."==g||"-"==g;d?"-"==g?(a.push(parseFloat(e)),e=g):f?e+=g:(a.push(parseFloat(e)),","!=g&&" "!=g&&a.push(g),d=!1):f?(e=g,d=!0):","!=g&&" "!=g&&a.push(g)}d&&a.push(parseFloat(e));return a};g.SVG._toksToPath=function(b,a){var c=0,d=0,e=0,f=0,h=0,k={M:2,L:2,H:1,V:1,S:4,C:6},l=a.cmds;for(a=a.crds;c<b.length;){var n=b[c];c++;if("z"==n)l.push("Z"),d=f,e=h;else for(var t=n.toUpperCase(),m=g.SVG._reps(b,c,k[t]),p=0;p<m;p++){var q=0,u=0;n!=t&&(q=d,u=e);if("M"==t)d=q+b[c++],e=u+b[c++],l.push("M"),
a.push(d,e),f=d,h=e;else if("L"==t)d=q+b[c++],e=u+b[c++],l.push("L"),a.push(d,e);else if("H"==t)d=q+b[c++],l.push("L"),a.push(d,e);else if("V"==t)e=u+b[c++],l.push("L"),a.push(d,e);else if("C"==t){d=q+b[c++];e=u+b[c++];var v=q+b[c++],w=u+b[c++];q+=b[c++];u+=b[c++];l.push("C");a.push(d,e,v,w,q,u);d=q;e=u}else"S"==t?(v=Math.max(a.length-4,0),d=d+d-a[v],e=e+e-a[v+1],v=q+b[c++],w=u+b[c++],q+=b[c++],u+=b[c++],l.push("C"),a.push(d,e,v,w,q,u),d=q,e=u):console.log("Unknown SVG command "+n)}}};g.SVG._reps=
function(b,a,c){for(var d=a;d<b.length&&"string"!=typeof b[d];)d+=c;return(d-a)/c};null==g&&(g={});null==g.U&&(g.U={});g.U.codeToGlyph=function(b,a){b=b.cmap;var c=-1;null!=b.p0e4?c=b.p0e4:null!=b.p3e1?c=b.p3e1:null!=b.p1e0?c=b.p1e0:null!=b.p0e3&&(c=b.p0e3);if(-1==c)throw"no familiar platform and encoding!";b=b.tables[c];if(0==b.format)return a>=b.map.length?0:b.map[a];if(4==b.format){var d=-1;for(c=0;c<b.endCount.length;c++)if(a<=b.endCount[c]){d=c;break}return-1==d||b.startCount[d]>a?0:(0!=b.idRangeOffset[d]?
b.glyphIdArray[a-b.startCount[d]+(b.idRangeOffset[d]>>1)-(b.idRangeOffset.length-d)]:a+b.idDelta[d])&65535}if(12==b.format){if(a>b.groups[b.groups.length-1][1])return 0;for(c=0;c<b.groups.length;c++)if(d=b.groups[c],d[0]<=a&&a<=d[1])return d[2]+(a-d[0]);return 0}throw"unknown cmap table format "+b.format;};g.U.glyphToPath=function(b,a){var c={cmds:[],crds:[]};if(b.SVG&&b.SVG.entries[a]){var d=b.SVG.entries[a];if(null==d)return c;"string"==typeof d&&(d=g.SVG.toPath(d),b.SVG.entries[a]=d);return d}if(b.CFF){d=
{x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:b.CFF.Private?b.CFF.Private.defaultWidthX:0,open:!1};var e=b.CFF,f=b.CFF.Private;if(e.ROS){for(f=0;e.FDSelect[f+2]<=a;)f+=2;f=e.FDArray[e.FDSelect[f+1]].Private}g.U._drawCFF(b.CFF.CharStrings[a],d,e,f,c)}else b.glyf&&g.U._drawGlyf(a,b,c);return c};g.U._drawGlyf=function(b,a,c){var d=a.glyf[b];null==d&&(d=a.glyf[b]=g.glyf._parseGlyf(a,b));null!=d&&(-1<d.noc?g.U._simpleGlyph(d,c):g.U._compoGlyph(d,a,c))};g.U._simpleGlyph=function(b,a){for(var c=0;c<b.noc;c++){for(var d=
0==c?0:b.endPts[c-1]+1,e=b.endPts[c],f=d;f<=e;f++){var h=f==d?e:f-1,k=f==e?d:f+1,l=b.flags[f]&1,n=b.flags[h]&1,t=b.flags[k]&1,m=b.xs[f],p=b.ys[f];if(f==d)if(l)if(n)g.U.P.moveTo(a,b.xs[h],b.ys[h]);else{g.U.P.moveTo(a,m,p);continue}else n?g.U.P.moveTo(a,b.xs[h],b.ys[h]):g.U.P.moveTo(a,(b.xs[h]+m)/2,(b.ys[h]+p)/2);l?n&&g.U.P.lineTo(a,m,p):t?g.U.P.qcurveTo(a,m,p,b.xs[k],b.ys[k]):g.U.P.qcurveTo(a,m,p,(m+b.xs[k])/2,(p+b.ys[k])/2)}g.U.P.closePath(a)}};g.U._compoGlyph=function(b,a,c){for(var d=0;d<b.parts.length;d++){var e=
{cmds:[],crds:[]},f=b.parts[d];g.U._drawGlyf(f.glyphIndex,a,e);f=f.m;for(var h=0;h<e.crds.length;h+=2){var k=e.crds[h],l=e.crds[h+1];c.crds.push(k*f.a+l*f.b+f.tx);c.crds.push(k*f.c+l*f.d+f.ty)}for(h=0;h<e.cmds.length;h++)c.cmds.push(e.cmds[h])}};g.U._getGlyphClass=function(b,a){b=g._lctf.getInterval(a,b);return-1==b?0:a[b+2]};g.U.getPairAdjustment=function(b,a,c){if(b.GPOS){var d=b.GPOS,e=d.lookupList;d=d.featureList;for(var f=[],h=0;h<d.length;h++){var k=d[h];if("kern"==k.tag)for(var l=0;l<k.tab.length;l++)if(!f[k.tab[l]]){f[k.tab[l]]=
!0;for(var n=e[k.tab[l]],t=0;t<n.tabs.length;t++)if(null!=n.tabs[h]){var m=n.tabs[t];if(m.coverage){var p=g._lctf.coverageIndex(m.coverage,a);if(-1==p)continue}if(1!=n.ltype&&2==n.ltype){var q;if(1==m.fmt)for(m=m.pairsets[p],h=0;h<m.length;h++)m[h].gid2==c&&(q=m[h]);else if(2==m.fmt){q=g.U._getGlyphClass(a,m.classDef1);var u=g.U._getGlyphClass(c,m.classDef2);q=m.matrix[q][u]}if(q&&q.val2)return q.val2[2]}}}}}return b.kern&&(a=b.kern.glyph1.indexOf(a),-1!=a&&(c=b.kern.rval[a].glyph2.indexOf(c),-1!=
c))?b.kern.rval[a].vals[c]:0};g.U.stringToGlyphs=function(b,a){for(var c=[],d=0;d<a.length;d++){var e=a.codePointAt(d);65535<e&&d++;c.push(g.U.codeToGlyph(b,e))}for(d=0;d<a.length;d++){e=a.codePointAt(d);if(2367==e){var f=c[d-1];c[d-1]=c[d];c[d]=f}65535<e&&d++}d=b.GSUB;if(null==d)return c;b=d.lookupList;d=d.featureList;e="rlig liga mset isol init fina medi half pres blws".split(" ");f=[];for(var h=0;h<d.length;h++){var k=d[h];if(-1!=e.indexOf(k.tag))for(var l=0;l<k.tab.length;l++)if(!f[k.tab[l]]){f[k.tab[l]]=
!0;for(var n=b[k.tab[l]],t=0;t<c.length;t++){var m=g.U._getWPfeature(a,t);-1!="isol,init,fina,medi".indexOf(k.tag)&&k.tag!=m||g.U._applySubs(c,t,n,b)}}}return c};g.U._getWPfeature=function(b,a){var c=0==a||-1!='\n\t" ,.:;!?()  \u060c'.indexOf(b[a-1]),d=a==b.length-1||-1!='\n\t" ,.:;!?()  \u060c'.indexOf(b[a+1]);c||-1=="\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0671\u0672\u0673\u0675\u0676\u0677\u0688\u0689\u068a\u068b\u068c\u068d\u068e\u068f\u0690\u0691\u0692\u0693\u0694\u0695\u0696\u0697\u0698\u0699\u06c0\u06c3\u06c4\u06c5\u06c6\u06c7\u06c8\u06c9\u06ca\u06cb\u06cd\u06cf\u06d2\u06d3\u06d5\u06ee\u06ef\u0710\u0715\u0716\u0717\u0718\u0719\u071e\u0728\u072a\u072c\u072f\u074d\u0759\u075a\u075b\u076b\u076c\u0771\u0773\u0774\u0778\u0779\u0840\u0846\u0847\u0849\u0854\u0867\u0869\u086a\u08aa\u08ab\u08ac\u08ae\u08b1\u08b2\u08b9\u0ac5\u0ac7\u0ac9\u0aca\u0ace\u0acf\u0ad0\u0ad1\u0ad2\u0add\u0ae1\u0ae4\u0aef\u0b81\u0b83\u0b84\u0b85\u0b89\u0b8c\u0b8e\u0b8f\u0b91\u0ba9\u0baa\u0bab\u0bac".indexOf(b[a-
1])||(c=!0);d||-1=="\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0671\u0672\u0673\u0675\u0676\u0677\u0688\u0689\u068a\u068b\u068c\u068d\u068e\u068f\u0690\u0691\u0692\u0693\u0694\u0695\u0696\u0697\u0698\u0699\u06c0\u06c3\u06c4\u06c5\u06c6\u06c7\u06c8\u06c9\u06ca\u06cb\u06cd\u06cf\u06d2\u06d3\u06d5\u06ee\u06ef\u0710\u0715\u0716\u0717\u0718\u0719\u071e\u0728\u072a\u072c\u072f\u074d\u0759\u075a\u075b\u076b\u076c\u0771\u0773\u0774\u0778\u0779\u0840\u0846\u0847\u0849\u0854\u0867\u0869\u086a\u08aa\u08ab\u08ac\u08ae\u08b1\u08b2\u08b9\u0ac5\u0ac7\u0ac9\u0aca\u0ace\u0acf\u0ad0\u0ad1\u0ad2\u0add\u0ae1\u0ae4\u0aef\u0b81\u0b83\u0b84\u0b85\u0b89\u0b8c\u0b8e\u0b8f\u0b91\u0ba9\u0baa\u0bab\u0bac".indexOf(b[a])||
(d=!0);d||-1=="\ua872\u0acd\u0ad7".indexOf(b[a+1])||(d=!0);c||-1=="\ua872\u0acd\u0ad7".indexOf(b[a])||(c=!0);return c?d?"isol":"init":d?"fina":"medi"};g.U._applySubs=function(b,a,c,d){for(var e=b.length-a-1,f=0;f<c.tabs.length;f++)if(null!=c.tabs[f]){var h=c.tabs[f];if(h.coverage){var k=g._lctf.coverageIndex(h.coverage,b[a]);if(-1==k)continue}if(1==c.ltype)b[a]=1==h.fmt?b[a]+h.delta:h.newg[k];else if(4==c.ltype)for(var l=h.vals[k],n=0;n<l.length;n++){var t=l[n];h=t.chain.length;if(!(h>e)){for(var m=
!0,p=0,q=0;q<h;q++){for(;-1==b[a+p+(1+q)];)p++;t.chain[q]!=b[a+p+(1+q)]&&(m=!1)}if(m){b[a]=t.nglyph;for(q=0;q<h+p;q++)b[a+q+1]=-1;break}}}else if(5==c.ltype&&2==h.fmt)for(l=g._lctf.getInterval(h.cDef,b[a]),p=h.scset[h.cDef[l+2]],t=0;t<p.length;t++){n=p[t];var u=n.input;if(!(u.length>e)){m=!0;for(q=0;q<u.length;q++){var v=g._lctf.getInterval(h.cDef,b[a+1+q]);if(-1==l&&h.cDef[v+2]!=u[q]){m=!1;break}}if(m)for(m=n.substLookupRecords,n=0;n<m.length;n+=2);}}else if(6==c.ltype&&3==h.fmt&&g.U._glsCovered(b,
h.backCvg,a-h.backCvg.length)&&g.U._glsCovered(b,h.inptCvg,a)&&g.U._glsCovered(b,h.ahedCvg,a+h.inptCvg.length))for(m=h.lookupRec,t=0;t<m.length;t+=2)l=m[t],g.U._applySubs(b,a+l,d[m[t+1]],d)}};g.U._glsCovered=function(b,a,c){for(var d=0;d<a.length;d++)if(-1==g._lctf.coverageIndex(a[d],b[c+d]))return!1;return!0};g.U.glyphsToPath=function(b,a,c){for(var d={cmds:[],crds:[]},e=0,f=0;f<a.length;f++){var h=a[f];if(-1!=h){for(var k=f<a.length-1&&-1!=a[f+1]?a[f+1]:0,l=g.U.glyphToPath(b,h),n=0;n<l.crds.length;n+=
2)d.crds.push(l.crds[n]+e),d.crds.push(l.crds[n+1]);c&&d.cmds.push(c);for(n=0;n<l.cmds.length;n++)d.cmds.push(l.cmds[n]);c&&d.cmds.push("X");e+=b.hmtx.aWidth[h];f<a.length-1&&(e+=g.U.getPairAdjustment(b,h,k))}}return d};g.U.pathToSVG=function(b,a){null==a&&(a=5);for(var c=[],d=0,e={M:2,L:2,Q:4,C:6},f=0;f<b.cmds.length;f++){var g=b.cmds[f],k=d+(e[g]?e[g]:0);for(c.push(g);d<k;)g=b.crds[d++],c.push(parseFloat(g.toFixed(a))+(d==k?"":" "))}return c.join("")};g.U.pathToContext=function(b,a){for(var c=0,
d=b.crds,e=0;e<b.cmds.length;e++){var f=b.cmds[e];"M"==f?(a.moveTo(d[c],d[c+1]),c+=2):"L"==f?(a.lineTo(d[c],d[c+1]),c+=2):"C"==f?(a.bezierCurveTo(d[c],d[c+1],d[c+2],d[c+3],d[c+4],d[c+5]),c+=6):"Q"==f?(a.quadraticCurveTo(d[c],d[c+1],d[c+2],d[c+3]),c+=4):"#"==f.charAt(0)?(a.beginPath(),a.fillStyle=f):"Z"==f?a.closePath():"X"==f&&a.fill()}};g.U.P={};g.U.P.moveTo=function(b,a,c){b.cmds.push("M");b.crds.push(a,c)};g.U.P.lineTo=function(b,a,c){b.cmds.push("L");b.crds.push(a,c)};g.U.P.curveTo=function(b,
a,c,d,e,f,g){b.cmds.push("C");b.crds.push(a,c,d,e,f,g)};g.U.P.qcurveTo=function(b,a,c,d,e){b.cmds.push("Q");b.crds.push(a,c,d,e)};g.U.P.closePath=function(b){b.cmds.push("Z")};g.U._drawCFF=function(b,a,c,d,e){for(var f=a.stack,h=a.nStems,k=a.haveWidth,l=a.width,n=a.open,t=0,m=a.x,p=a.y,q,u,v,w,x,z,C,E,D,r,A={val:0,size:0};t<b.length;){g.CFF.getCharString(b,t,A);var y=A.val;t+=A.size;if("o1"==y||"o18"==y)(q=0!==f.length%2)&&!k&&(l=f.shift()+d.nominalWidthX),h+=f.length>>1,f.length=0,k=!0;else if("o3"==
y||"o23"==y)(q=0!==f.length%2)&&!k&&(l=f.shift()+d.nominalWidthX),h+=f.length>>1,f.length=0,k=!0;else if("o4"==y)1<f.length&&!k&&(l=f.shift()+d.nominalWidthX,k=!0),n&&g.U.P.closePath(e),p+=f.pop(),g.U.P.moveTo(e,m,p),n=!0;else if("o5"==y)for(;0<f.length;)m+=f.shift(),p+=f.shift(),g.U.P.lineTo(e,m,p);else if("o6"==y||"o7"==y)for(x=f.length,q="o6"==y,u=0;u<x;u++)v=f.shift(),q?m+=v:p+=v,q=!q,g.U.P.lineTo(e,m,p);else if("o8"==y||"o24"==y){x=f.length;for(z=0;z+6<=x;)q=m+f.shift(),u=p+f.shift(),v=q+f.shift(),
w=u+f.shift(),m=v+f.shift(),p=w+f.shift(),g.U.P.curveTo(e,q,u,v,w,m,p),z+=6;"o24"==y&&(m+=f.shift(),p+=f.shift(),g.U.P.lineTo(e,m,p))}else if("o11"==y)break;else if("o1234"==y||"o1235"==y||"o1236"==y||"o1237"==y)"o1234"==y&&(q=m+f.shift(),u=p,v=q+f.shift(),w=u+f.shift(),D=v+f.shift(),r=w,x=D+f.shift(),z=w,C=x+f.shift(),E=p,m=C+f.shift(),g.U.P.curveTo(e,q,u,v,w,D,r),g.U.P.curveTo(e,x,z,C,E,m,p)),"o1235"==y&&(q=m+f.shift(),u=p+f.shift(),v=q+f.shift(),w=u+f.shift(),D=v+f.shift(),r=w+f.shift(),x=D+f.shift(),
z=r+f.shift(),C=x+f.shift(),E=z+f.shift(),m=C+f.shift(),p=E+f.shift(),f.shift(),g.U.P.curveTo(e,q,u,v,w,D,r),g.U.P.curveTo(e,x,z,C,E,m,p)),"o1236"==y&&(q=m+f.shift(),u=p+f.shift(),v=q+f.shift(),w=u+f.shift(),D=v+f.shift(),r=w,x=D+f.shift(),z=w,C=x+f.shift(),E=z+f.shift(),m=C+f.shift(),g.U.P.curveTo(e,q,u,v,w,D,r),g.U.P.curveTo(e,x,z,C,E,m,p)),"o1237"==y&&(q=m+f.shift(),u=p+f.shift(),v=q+f.shift(),w=u+f.shift(),D=v+f.shift(),r=w+f.shift(),x=D+f.shift(),z=r+f.shift(),C=x+f.shift(),E=z+f.shift(),Math.abs(C-
m)>Math.abs(E-p)?m=C+f.shift():p=E+f.shift(),g.U.P.curveTo(e,q,u,v,w,D,r),g.U.P.curveTo(e,x,z,C,E,m,p));else if("o14"==y)0<f.length&&!k&&(l=f.shift()+c.nominalWidthX,k=!0),4==f.length&&(q=f.shift(),u=f.shift(),w=f.shift(),v=f.shift(),w=g.CFF.glyphBySE(c,w),v=g.CFF.glyphBySE(c,v),g.U._drawCFF(c.CharStrings[w],a,c,d,e),a.x=q,a.y=u,g.U._drawCFF(c.CharStrings[v],a,c,d,e)),n&&(g.U.P.closePath(e),n=!1);else if("o19"==y||"o20"==y)(q=0!==f.length%2)&&!k&&(l=f.shift()+d.nominalWidthX),h+=f.length>>1,f.length=
0,k=!0,t+=h+7>>3;else if("o21"==y)2<f.length&&!k&&(l=f.shift()+d.nominalWidthX,k=!0),p+=f.pop(),m+=f.pop(),n&&g.U.P.closePath(e),g.U.P.moveTo(e,m,p),n=!0;else if("o22"==y)1<f.length&&!k&&(l=f.shift()+d.nominalWidthX,k=!0),m+=f.pop(),n&&g.U.P.closePath(e),g.U.P.moveTo(e,m,p),n=!0;else if("o25"==y){for(;6<f.length;)m+=f.shift(),p+=f.shift(),g.U.P.lineTo(e,m,p);q=m+f.shift();u=p+f.shift();v=q+f.shift();w=u+f.shift();m=v+f.shift();p=w+f.shift();g.U.P.curveTo(e,q,u,v,w,m,p)}else if("o26"==y)for(f.length%
2&&(m+=f.shift());0<f.length;)q=m,u=p+f.shift(),v=q+f.shift(),w=u+f.shift(),m=v,p=w+f.shift(),g.U.P.curveTo(e,q,u,v,w,m,p);else if("o27"==y)for(f.length%2&&(p+=f.shift());0<f.length;)q=m+f.shift(),u=p,v=q+f.shift(),w=u+f.shift(),m=v+f.shift(),p=w,g.U.P.curveTo(e,q,u,v,w,m,p);else if("o10"==y||"o29"==y)q="o10"==y?d:c,0==f.length?console.log("error: empty stack"):(u=f.pop(),q=q.Subrs[u+q.Bias],a.x=m,a.y=p,a.nStems=h,a.haveWidth=k,a.width=l,a.open=n,g.U._drawCFF(q,a,c,d,e),m=a.x,p=a.y,h=a.nStems,k=a.haveWidth,
l=a.width,n=a.open);else if("o30"==y||"o31"==y)for(q=f.length,z=0,y="o31"==y,x=q&-3,z+=q-x;z<x;)y?(q=m+f.shift(),u=p,v=q+f.shift(),w=u+f.shift(),p=w+f.shift(),5==x-z?(m=v+f.shift(),z++):m=v,y=!1):(q=m,u=p+f.shift(),v=q+f.shift(),w=u+f.shift(),m=v+f.shift(),5==x-z?(p=w+f.shift(),z++):p=w,y=!0),g.U.P.curveTo(e,q,u,v,w,m,p),z+=4;else{if("o"==(y+"").charAt(0))throw console.log("Unknown operation: "+y,b),y;f.push(y)}}a.x=m;a.y=p;a.nStems=h;a.haveWidth=k;a.width=l;a.open=n};return g},function(){function r(b,
a){function c(){var a=g.getUint16(k);k+=2;return a}function d(){var a=g.getUint32(k);k+=4;return a}function e(a){x.setUint16(z,a);z+=2}function f(a){x.setUint32(z,a);z+=4}var g=new DataView(b),k=0;d();var l=d();d();var n=c();c();d();c();c();d();d();d();d();d();for(var t=0;Math.pow(2,t)<=n;)t++;t--;for(var m=16*Math.pow(2,t),p=16*n-m,q=12,u=[],v=0;v<n;v++)u.push({tag:d(),offset:d(),compLength:d(),origLength:d(),origChecksum:d()}),q+=16;var w=new Uint8Array(12+16*u.length+u.reduce(function(a,b){return a+
b.origLength+4},0));v=w.buffer;var x=new DataView(v),z=0;f(l);e(n);e(m);e(t);e(p);u.forEach(function(a){f(a.tag);f(a.origChecksum);f(q);f(a.origLength);a.outOffset=q;q+=a.origLength;0!=q%4&&(q+=4-q%4)});var C;u.forEach(function(c){var d=b.slice(c.offset,c.offset+c.compLength);if(c.compLength!=c.origLength){var e=new Uint8Array(c.origLength);a(new Uint8Array(d,2),e)}else e=new Uint8Array(d);w.set(e,c.outOffset);q=c.outOffset+c.origLength;d=0;0!=q%4&&(d=4-q%4);w.set((new Uint8Array(d)).buffer,c.outOffset+
c.origLength);C=q+d});return v.slice(0,C)}var g=function(){function b(){this.table=new Uint16Array(16);this.trans=new Uint16Array(288)}function a(a,c){this.source=a;this.bitcount=this.tag=this.sourceIndex=0;this.dest=c;this.destLen=0;this.ltree=new b;this.dtree=new b}function c(a,b,c,d){var e;for(e=0;e<c;++e)a[e]=0;for(e=0;e<30-c;++e)a[e+c]=e/c|0;c=d;for(e=0;30>e;++e)b[e]=c,c+=1<<a[e]}function d(a,b,c,d){var e,f;for(e=0;16>e;++e)a.table[e]=0;for(e=0;e<d;++e)a.table[b[c+e]]++;for(e=f=a.table[0]=0;16>
e;++e)w[e]=f,f+=a.table[e];for(e=0;e<d;++e)b[c+e]&&(a.trans[w[b[c+e]]++]=e)}function e(a,b,c){if(!b)return c;for(;24>a.bitcount;)a.tag|=a.source[a.sourceIndex++]<<a.bitcount,a.bitcount+=8;var d=a.tag&65535>>>16-b;a.tag>>>=b;a.bitcount-=b;return d+c}function f(a,b){for(;24>a.bitcount;)a.tag|=a.source[a.sourceIndex++]<<a.bitcount,a.bitcount+=8;var c=0,d=0,e=0,f=a.tag;do d=2*d+(f&1),f>>>=1,++e,c+=b.table[e],d-=b.table[e];while(0<=d);a.tag=f;a.bitcount-=e;return b.trans[c+d]}function g(a,b,c){for(;;){var d=
f(a,b);if(256===d)return 0;if(256>d)a.dest[a.destLen++]=d;else{var g;d-=257;d=e(a,n[d],t[d]);var h=f(a,c);for(g=h=a.destLen-e(a,m[h],p[h]);g<h+d;++g)a.dest[a.destLen++]=a.dest[g]}}}var k=new b,l=new b,n=new Uint8Array(30),t=new Uint16Array(30),m=new Uint8Array(30),p=new Uint16Array(30),q=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=new b,v=new Uint8Array(320),w=new Uint16Array(16);(function(a,b){var c;for(c=0;7>c;++c)a.table[c]=0;a.table[7]=24;a.table[8]=152;a.table[9]=112;for(c=
0;24>c;++c)a.trans[c]=256+c;for(c=0;144>c;++c)a.trans[24+c]=c;for(c=0;8>c;++c)a.trans[168+c]=280+c;for(c=0;112>c;++c)a.trans[176+c]=144+c;for(c=0;5>c;++c)b.table[c]=0;b.table[5]=32;for(c=0;32>c;++c)b.trans[c]=c})(k,l);c(n,t,4,3);c(m,p,2,1);n[28]=0;t[28]=258;return function(b,c){b=new a(b,c);do{c=b;c.bitcount--||(c.tag=c.source[c.sourceIndex++],c.bitcount=7);var h=c.tag&1;c.tag>>>=1;c=h;h=e(b,2,0);switch(h){case 0:for(h=b;8<h.bitcount;)h.sourceIndex--,h.bitcount-=8;var m=h.source[h.sourceIndex+1];
m=256*m+h.source[h.sourceIndex];var p=h.source[h.sourceIndex+3];p=256*p+h.source[h.sourceIndex+2];if(m!==(~p&65535))h=-3;else{h.sourceIndex+=4;for(p=m;p;--p)h.dest[h.destLen++]=h.source[h.sourceIndex++];h=h.bitcount=0}break;case 1:h=g(b,k,l);break;case 2:var n;m=b;var w=b.ltree,t=b.dtree;p=e(m,5,257);h=e(m,5,1);var r=e(m,4,4);for(n=0;19>n;++n)v[n]=0;for(n=0;n<r;++n){var x=e(m,3,0);v[q[n]]=x}d(u,v,0,19);for(n=0;n<p+h;)switch(r=f(m,u),r){case 16:x=v[n-1];for(r=e(m,2,3);r;--r)v[n++]=x;break;case 17:for(r=
e(m,3,3);r;--r)v[n++]=0;break;case 18:for(r=e(m,7,11);r;--r)v[n++]=0;break;default:v[n++]=r}d(w,v,0,p);d(t,v,p,h);h=g(b,b.ltree,b.dtree);break;default:h=-3}if(0!==h)throw Error("Data error");}while(!c);return b.destLen<b.dest.length?"function"===typeof b.dest.slice?b.dest.slice(0,b.destLen):b.dest.subarray(0,b.destLen):b.dest}}();return function(b){return r(b,g)}},function(r,g){function b(b){var c=Object.create(null),e={unitsPerEm:b.head.unitsPerEm,ascender:b.hhea.ascender,descender:b.hhea.descender,
forEachGlyph:function(d,g,k,l){var f=0,h=1/e.unitsPerEm*g,m=0;r.U.stringToGlyphs(b,d).forEach(function(e){if(-1!==e){var q=c[e];if(!q){q=r.U.glyphToPath(b,e);var p=q.cmds,v=q.crds,n,t;if(v.length){q=n=Infinity;var z=t=-Infinity;for(var C=0,E=v.length;C<E;C+=2){var D=v[C],A=v[C+1];D<q&&(q=D);A<n&&(n=A);D>z&&(z=D);A>t&&(t=A)}}else q=z=n=t=0;q=c[e]={index:e,advanceWidth:b.hmtx.aWidth[e],xMin:q,yMin:n,xMax:z,yMax:t,pathCommandCount:p.length,forEachPathCommand:function(b){for(var c=0,d=[],e=0,f=p.length;e<
f;e++){var g=a[p[e]];d.length=1+g;d[0]=p[e];for(var h=1;h<=g;h++)d[h]=v[c++];b.apply(null,d)}}}}l.call(null,q,f,m);q.advanceWidth&&(f+=q.advanceWidth*h);k&&(f+=k*g)}m+=65535<d.codePointAt(m)?2:1});return f}};return e}var a={M:2,L:2,Q:4,C:6,Z:0};return function(a){var c=new Uint8Array(a,0,4);c=r._bin.readASCII(c,0,4);if("wOFF"===c)a=g(a);else if("wOF2"===c)throw Error("woff2 fonts not supported");return b(r.parse(a)[0])}}],init:function(r,g,b){r=r();g=g();return b(r,g)}}),I={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",
sdfGlyphSize:64,sdfMargin:.0625,sdfExponent:9,textureWidth:2048},na=new A.Color,W=!1,ba=Object.create(null),N;P=J.defineWorkerModule({name:"FontProcessor",dependencies:[I,P,function(){function r(){g&&(b.sort(function(a,b){return a.maxX-b.maxX}),g=!1)}var g=!1,b=[];return{addLineSegment:function(a,c,d,e){b.push({x0:a,y0:c,x1:d,y1:e,minX:Math.min(a,d),minY:Math.min(c,e),maxX:Math.max(a,d),maxY:Math.max(c,e)});g=!0},findNearestSignedDistance:function(a,c){r();for(var d=Infinity,e=Infinity,f=b.length;f--;){var g=
b[f];if(g.maxX+e<=a)break;if(a+e>g.minX&&c-e<g.maxY&&c+e>g.minY){var k=g.x0;var l=g.y0;var n=g.x1-k;g=g.y1-l;var t=n*n+g*g;t=t?Math.max(0,Math.min(1,((a-k)*n+(c-l)*g)/t)):0;k=a-(k+t*n);l=c-(l+t*g);l=k*k+l*l;l<d&&(d=l,e=Math.sqrt(d))}}r();d=!1;for(f=b.length;f--;){l=b[f];if(l.maxX<=a)break;l.minY<c&&l.maxY>c&&l.y0>c!==l.y1>c&&a<(l.x1-l.x0)*(c-l.y0)/(l.y1-l.y0)+l.x0&&(d=!d)}d&&(e=-e);return e}}},function(r,g){var b=g.sdfExponent,a=g.sdfMargin;return function(c,d){var e=new Uint8Array(d*d),f=c.xMax-
c.xMin,g=c.yMax-c.yMin,k=Math.max(f,g),l=Math.max(f,g)/d*(a*d+.5);f=c.xMin-l;g=c.yMin-l;var n=c.xMax+l;l=c.yMax+l;var t=n-f,m=l-g,p=Math.max(t,m);if(c.pathCommandCount){var q=r(c),u,v,w,x;c.forEachPathCommand(function(a,b,c,d,e,f,g){switch(a){case "M":w=u=b;x=v=c;break;case "L":b===w&&c===x||q.addLineSegment(w,x,w=b,x=c);break;case "Q":f={x:w,y:x};for(g=1;16>g;g++){a=g/15;var h=1-a;a={x:h*h*w+2*h*a*b+a*a*d,y:h*h*x+2*h*a*c+a*a*e};q.addLineSegment(f.x,f.y,a.x,a.y);f=a}w=d;x=e;break;case "C":a={x:w,
y:x};for(h=1;16>h;h++){var k=h/15;var m=1-k;k={x:m*m*m*w+3*m*m*k*b+3*m*k*k*d+k*k*k*f,y:m*m*m*x+3*m*m*k*c+3*m*k*k*e+k*k*k*g};q.addLineSegment(a.x,a.y,k.x,k.y);a=k}w=f;x=g;break;case "Z":w===u&&x===v||q.addLineSegment(w,x,u,v)}});for(c=0;c<d;c++)for(var z=0;z<d;z++){var C=q.findNearestSignedDistance(f+t*(c+.5)/d,g+m*(z+.5)/d,k),E=Math.pow(1-Math.abs(C)/p,b)/2;0>C&&(E=1-E);E=Math.max(0,Math.min(255,Math.round(255*E)));e[z*d+c]=E}}return{textureData:e,renderingBounds:[f,g,n,l]}}},function(r,g,b){function a(a,
b){function c(){var d=function(b){console.error("Failure loading font "+a+(a===l?"":"; trying fallback"),b);a!==l&&(a=l,c())};try{var e=new XMLHttpRequest;e.open("get",a,!0);e.responseType="arraybuffer";e.onload=function(){if(400<=e.status)d(Error(e.statusText));else if(0<e.status)try{var a=r(e.response);b(a)}catch(x){d(x)}};e.onerror=d;e.send()}catch(w){d(w)}}c()}function c(b,c){b||(b=l);var d=t[b];d?d.pending?d.pending.push(c):c(d):(t[b]={pending:[c]},a(b,function(a){var c=t[b].pending;t[b]=a;c.forEach(function(b){return b(a)})}))}
function d(a,b,d){a||(a=l);var e=a+"@"+b,f=n[e];f?d(f):c(a,function(a){f=n[e]||(n[e]={fontObj:a,glyphs:{},glyphCount:0});d(f)})}function e(a,b,c){var e=a.text;void 0===e&&(e="");var m=a.font;void 0===m&&(m=l);var q=a.sdfGlyphSize;void 0===q&&(q=64);var n=a.fontSize;void 0===n&&(n=1);var p=a.letterSpacing;void 0===p&&(p=0);var r=a.lineHeight;void 0===r&&(r="normal");var t=a.maxWidth;void 0===t&&(t=Infinity);var A=a.textAlign;void 0===A&&(A="left");var B=a.textIndent;void 0===B&&(B=0);var J=a.whiteSpace;
void 0===J&&(J="normal");var y=a.overflowWrap;void 0===y&&(y="normal");var K=a.anchorX;void 0===K&&(K=0);var G=a.anchorY;void 0===G&&(G=0);var I=a.includeCaretPositions;void 0===I&&(I=!1);var N=a.chunkedBoundsSize;void 0===N&&(N=8192);var O=a.colorRanges;void 0===O&&(O=null);void 0===c&&(c=!1);var P=h(),L={total:0,fontLoad:0,layout:0,sdf:{},sdfTotal:0};-1<e.indexOf("\r")&&(console.warn("FontProcessor.process: got text with \\r chars; normalizing to \\n"),e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n"));
n=+n;p=+p;t=+t;r=r||"normal";B=+B;d(m,q,function(a){var d=a.fontObj,l=isFinite(t),m=null,v=null,u=null,w=null,x=null,z=null,C=null,E=0,D=0,Y="nowrap"!==J,R=d.ascender,S=d.descender,X=d.unitsPerEm;L.fontLoad=h()-P;var Z=h(),F=n/X;"normal"===r&&(r=(R-S)/X);r*=n;X=(r-(R-S)*F)/2;var ha=-(R*F+X),W=Math.min(r,(R-S)*F),aa=(R+S)/2*F-W/2,T=B,H=new k,U=[H];d.forEachGlyph(e,n,p,function(a,b,c){var d=e.charAt(c),f=a.advanceWidth*F,g=H.count;"isEmpty"in a||(a.isWhitespace=!!d&&/\s/.test(d),a.isEmpty=a.xMin===
a.xMax||a.yMin===a.yMax);a.isWhitespace||a.isEmpty||D++;if(Y&&l&&!a.isWhitespace&&b+f+T>t&&g){if(H.glyphAt(g-1).glyphObj.isWhitespace){var h=new k;T=-b}else for(;g--;)if(0===g&&"break-word"===y){h=new k;T=-b;break}else if(H.glyphAt(g).glyphObj.isWhitespace){h=H.splitAt(g+1);g=h.glyphAt(0).x;T-=g;for(var m=h.count;m--;)h.glyphAt(m).x-=g;break}h&&(H.isSoftWrapped=!0,H=h,U.push(H),E=t)}h=H.glyphAt(H.count);h.glyphObj=a;h.x=b+T;h.width=f;h.charIndex=c;"\n"===d&&(H=new k,U.push(H),T=-(b+f+p*n)+B)});U.forEach(function(a){for(var b=
a.count;b--;){var c=a.glyphAt(b),d=c.x,e=c.width;if(!c.glyphObj.isWhitespace){a.width=d+e;a.width>E&&(E=a.width);break}}});var Q=0,V=0;K&&("number"===typeof K?Q=-K:"string"===typeof K&&(Q=-E*("left"===K?0:"center"===K?.5:"right"===K?1:f(K))));G&&("number"===typeof G?V=-G:"string"===typeof G&&(d=U.length*r,V="top"===G?0:"top-baseline"===G?-ha:"middle"===G?d/2:"bottom"===G?d:"bottom-baseline"===G?d-X+S*F:f(G)*d));if(!c){v=new Float32Array(4*D);u=new Float32Array(D);z=[Infinity,Infinity,-Infinity,-Infinity];
C=[];var ia=ha;I&&(x=new Float32Array(3*e.length));O&&(w=new Uint8Array(3*D));var ba=0,M=-1,da=-1,ea,fa;U.forEach(function(b){var c=b.count,d=b.width;if(0<c){var f=0,k=0;if("center"===A)f=(E-d)/2;else if("right"===A)f=E-d;else if("justify"===A&&b.isSoftWrapped){k=0;for(var l=c;l--;)if(!b.glyphAt(l).glyphObj.isWhitespace){for(;l--;){if(!b.glyphAt(l).glyphObj)debugger;b.glyphAt(l).glyphObj.isWhitespace&&k++}break}k=(E-d)/k}for(d=0;d<c;d++){var n=b.glyphAt(d);l=n.glyphObj;f&&(n.x+=f);0!==k&&l.isWhitespace&&
(f+=k,n.width+=k);if(I){var p=n.charIndex;x[3*p]=n.x+Q;x[3*p+1]=n.x+n.width+Q;for(x[3*p+2]=ia+aa+V;1<p-M;)x[3*(M+1)]=x[3*M+1],x[3*(M+1)+1]=x[3*M+1],x[3*(M+1)+2]=x[3*M+2],M++;M=p}if(O)for(p=n.charIndex;p>da;)da++,O.hasOwnProperty(da)&&(fa=O[da]);if(!l.isWhitespace&&!l.isEmpty){p=ba++;var t=a.glyphs[l.index];if(!t){t=h();var y=g(l,q);L.sdf[e.charAt(n.charIndex)]=h()-t;y.atlasIndex=a.glyphCount++;m||(m=[]);m.push(y);t=a.glyphs[l.index]={atlasIndex:y.atlasIndex,glyphObj:l,renderingBounds:y.renderingBounds}}y=
t.renderingBounds;var D=4*p,B=n.x+Q;n=ia+V;v[D]=B+y[0]*F;v[D+1]=n+y[1]*F;v[D+2]=B+y[2]*F;v[D+3]=n+y[3]*F;y=B+l.xMin*F;D=n+l.yMin*F;B+=l.xMax*F;l=n+l.yMax*F;y<z[0]&&(z[0]=y);D<z[1]&&(z[1]=D);B>z[2]&&(z[2]=B);l>z[3]&&(z[3]=l);0===p%N&&(ea={start:p,end:p,rect:[Infinity,Infinity,-Infinity,-Infinity]},C.push(ea));ea.end++;n=ea.rect;y<n[0]&&(n[0]=y);D<n[1]&&(n[1]=D);B>n[2]&&(n[2]=B);l>n[3]&&(n[3]=l);u[p]=t.atlasIndex;O&&(l=3*p,w[l]=fa>>16&255,w[l+1]=fa>>8&255,w[l+2]=fa&255)}}}ia-=r})}for(var ca in L.sdf)L.sdfTotal+=
L.sdf[ca];L.layout=h()-Z-L.sdfTotal;L.total=h()-P;b({glyphBounds:v,glyphAtlasIndices:u,caretPositions:x,caretHeight:W,glyphColors:w,chunkedBounds:C,ascender:R*F,descender:S*F,lineHeight:r,topBaseline:ha,blockBounds:[Q,V-U.length*r,Q+E,V],visibleBounds:z,newGlyphSDFs:m,timings:L})})}function f(a){a=(a=a.match(/^([\d.]+)%$/))?parseFloat(a[1]):NaN;return isNaN(a)?0:a/100}function h(){return(self.performance||Date).now()}function k(){this.data=[]}var l=b.defaultFontURL,n=Object.create(null),t=Object.create(null);
k.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/4)},glyphAt:function(a){var b=k.flyweight;b.data=this.data;b.index=a;return b},splitAt:function(a){var b=new k;b.data=this.data.splice(4*a);return b}};k.flyweight=["glyphObj","x","width","charIndex"].reduce(function(a,b,c,d){Object.defineProperty(a,b,{get:function(){return this.data[4*this.index+c]},set:function(a){this.data[4*this.index+c]=a}});return a},{data:null,index:0});return{process:e,measure:function(a,b){e(a,
function(a){a=a.blockBounds;b({width:a[2]-a[0],height:a[3]-a[1]})},{metricsOnly:!0})},loadFont:c}}],init:function(r,g,b,a,c){var d=r.defaultFontURL;r=a(b,{sdfExponent:r.sdfExponent,sdfMargin:r.sdfMargin});return c(g,r,{defaultFontURL:d})}});var oa=J.defineWorkerModule({name:"TextBuilder",dependencies:[P,J.ThenableWorkerModule],init:function(r,g){return function(b){var a=new g;r.process(b,a.resolve);return a}},getTransferables:function(r){var g=[r.glyphBounds.buffer,r.glyphAtlasIndices.buffer];r.caretPositions&&
g.push(r.caretPositions.buffer);r.newGlyphSDFs&&r.newGlyphSDFs.forEach(function(b){g.push(b.textureData.buffer)});return g}}),ka=function(){function r(b){var c=a[b];c||(c=a[b]=(new A.PlaneBufferGeometry(1,1,b,b)).translate(.5,.5,0));return c}function g(a,b,c,d){var e=a.getAttribute(b);c?e&&e.array.length===c.length?(e.array.set(c),e.needsUpdate=!0):(a.setAttribute(b,new A.InstancedBufferAttribute(c,d)),delete a._maxInstanceCount,a.dispose()):e&&a.deleteAttribute(b)}function b(a,b){a[a.hasOwnProperty("instanceCount")?
"instanceCount":"maxInstancedCount"]=b}var a={},c=new A.Vector3,d=function(a){function d(){a.call(this);this.detail=1;this.groups=[{start:0,count:Infinity,materialIndex:0},{start:0,count:Infinity,materialIndex:1}];this.boundingSphere=new A.Sphere;this.boundingBox=new A.Box3}a&&(d.__proto__=a);d.prototype=Object.create(a&&a.prototype);d.prototype.constructor=d;var e={detail:{configurable:!0}};d.prototype.computeBoundingSphere=function(){};d.prototype.computeBoundingBox=function(){};e.detail.set=function(a){var b=
this;if(a!==this._detail){this._detail=a;if("number"!==typeof a||1>a)a=1;var c=r(a);["position","normal","uv"].forEach(function(a){b.attributes[a]=c.attributes[a].clone()});this.setIndex(c.getIndex().clone())}};e.detail.get=function(){return this._detail};d.prototype.updateGlyphs=function(a,d,e,f,h){g(this,"aTroikaGlyphBounds",a,4);g(this,"aTroikaGlyphIndex",d,1);g(this,"aTroikaGlyphColor",h,3);this._chunkedBounds=f;b(this,d.length);a=this.boundingSphere;a.center.set((e[0]+e[2])/2,(e[1]+e[3])/2,0);
a.radius=a.center.distanceTo(c.set(e[0],e[1],0));a=this.boundingBox;a.min.set(e[0],e[1],0);a.max.set(e[2],e[3],0)};d.prototype.applyClipRect=function(a){var c=this.getAttribute("aTroikaGlyphIndex").count,d=this._chunkedBounds;if(d)for(var e=d.length;e--;){c=d[e].end;var f=d[e].rect;if(f[1]<a.w&&f[3]>a.y&&f[0]<a.z&&f[2]>a.x)break}b(this,c)};Object.defineProperties(d.prototype,e);return d}(A.InstancedBufferGeometry);d.prototype.setAttribute||(d.prototype.setAttribute=function(a,b){this.attributes[a]=
b;return this});return d}();J=function(){function r(a){return Array.isArray(a)?a[0]:a}var g=new A.MeshBasicMaterial({color:16777215,side:A.DoubleSide,transparent:!0}),b=new A.Matrix4,a=new A.Vector3,c=new A.Vector3,d=[],e=new A.Vector3,f=new A.Mesh((new A.PlaneBufferGeometry(1,1)).translate(.5,.5,0),g),h={type:"syncstart"},k={type:"synccomplete"},l="font fontSize letterSpacing lineHeight maxWidth overflowWrap text textAlign textIndent whiteSpace anchorX anchorY colorRanges sdfGlyphSize".split(" "),
n=l.concat("material","color","depthOffset","clipRect","orientation","glyphGeometryDetail"),t=function(l){function m(){var a=new ka;l.call(this,a,null);this.text="";this.anchorY=this.anchorX=0;this.font=null;this.fontSize=.1;this.letterSpacing=0;this.lineHeight="normal";this.maxWidth=Infinity;this.overflowWrap="normal";this.textAlign="left";this.textIndent=0;this.whiteSpace="normal";this.colorRanges=this.color=this.material=null;this.depthOffset=this.outlineColor=this.outlineWidth=0;this.clipRect=
null;this.orientation="+x+y";this.glyphGeometryDetail=1;this.sdfGlyphSize=null;this.debugSDF=!1}l&&(m.__proto__=l);m.prototype=Object.create(l&&l.prototype);m.prototype.constructor=m;var p={textRenderInfo:{configurable:!0},material:{configurable:!0},glyphGeometryDetail:{configurable:!0},customDepthMaterial:{configurable:!0},customDistanceMaterial:{configurable:!0}};m.prototype.sync=function(a){var b=this;this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(a):
(this._isSyncing=!0,this.dispatchEvent(h),Z({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize},function(c){b._isSyncing=!1;b._textRenderInfo=c;b.geometry.updateGlyphs(c.glyphBounds,
c.glyphAtlasIndices,c.blockBounds,c.chunkedBounds,c.glyphColors);var d=b._queuedSyncs;d&&(b._queuedSyncs=null,b._needsSync=!0,b.sync(function(){d.forEach(function(a){return a&&a()})}));b.dispatchEvent(k);a&&a()})))};m.prototype.onBeforeRender=function(a,b,c,d,e,f){this.sync();e.isTroikaTextMaterial&&this._prepareForRender(e)};m.prototype.dispose=function(){this.geometry.dispose()};p.textRenderInfo.get=function(){return this._textRenderInfo||null};p.material.get=function(){var a=this._derivedMaterial,
b=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=g.clone());a&&a.baseMaterial===b||(a=this._derivedMaterial=ca(b),b.addEventListener("dispose",function C(){b.removeEventListener("dispose",C);a.dispose()}));if(this.outlineWidth){var c=a._outlineMtl;c||(c=a._outlineMtl=Object.create(a,{id:{value:a.id+.1}}),c.isTextOutlineMaterial=!0,c.depthWrite=!1,c.map=null,a.addEventListener("dispose",function C(){a.removeEventListener("dispose",C);c.dispose()}));return[c,a]}return a};p.material.set=
function(a){a&&a.isTroikaTextMaterial?(this._derivedMaterial=a,this._baseMaterial=a.baseMaterial):this._baseMaterial=a};p.glyphGeometryDetail.get=function(){return this.geometry.detail};p.glyphGeometryDetail.set=function(a){this.geometry.detail=a};p.customDepthMaterial.get=function(){return r(this.material).getDepthMaterial()};p.customDistanceMaterial.get=function(){return r(this.material).getDistanceMaterial()};m.prototype._prepareForRender=function(d){var f=d.isTextOutlineMaterial,g=d.uniforms,
h=this.textRenderInfo;if(h){var k=h.sdfTexture,l=h.blockBounds;g.uTroikaSDFTexture.value=k;g.uTroikaSDFTextureSize.value.set(k.image.width,k.image.height);g.uTroikaSDFGlyphSize.value=h.sdfGlyphSize;g.uTroikaSDFExponent.value=h.sdfExponent;g.uTroikaTotalBounds.value.fromArray(l);g.uTroikaUseGlyphColors.value=!!h.glyphColors;h=0;f&&(h=this.outlineWidth,"string"===typeof h&&(h=(h=h.match(/^([\d.]+)%$/))?parseFloat(h[1]):NaN,h=(isNaN(h)?0:h/100)*this.fontSize));g.uTroikaDistanceOffset.value=h;(h=this.clipRect)&&
Array.isArray(h)&&4===h.length?g.uTroikaClipRect.value.fromArray(h):(h=100*(this.fontSize||.1),g.uTroikaClipRect.value.set(l[0]-h,l[1]-h,l[2]+h,l[3]+h));this.geometry.applyClipRect(g.uTroikaClipRect.value)}g.uTroikaSDFDebug.value=!!this.debugSDF;d.polygonOffset=!!this.depthOffset;d.polygonOffsetFactor=d.polygonOffsetUnits=this.depthOffset||0;f=f?this.outlineColor||0:this.color;null==f?delete d.color:(l=d.hasOwnProperty("color")?d.color:d.color=new A.Color,(f!==l._input||"object"===typeof f)&&l.set(l._input=
f));f=this.orientation||"+x+y";if(f!==d._orientation){g=g.uTroikaOrient.value;f=f.replace(/[^-+xyz]/g,"");var m="+x+y"!==f&&f.match(/^([-+])([xyz])([-+])([xyz])$/);m?(l=m[1],h=m[2],k=m[3],m=m[4],a.set(0,0,0)[h]="-"===l?1:-1,c.set(0,0,0)[m]="-"===k?-1:1,b.lookAt(e,a.cross(c),c),g.setFromMatrix4(b)):g.identity();d._orientation=f}};m.prototype.raycast=function(a,c){var e=this.textRenderInfo;if(e)for(e=e.blockBounds,f.matrixWorld.multiplyMatrices(this.matrixWorld,b.set(e[2]-e[0],0,0,e[0],0,e[3]-e[1],
0,e[1],0,0,1,0,0,0,0,1)),d.length=0,f.raycast(a,d),a=0;a<d.length;a++)d[a].object=this,c.push(d[a])};m.prototype.copy=function(a){var b=this;l.prototype.copy.call(this,a);n.forEach(function(c){b[c]=a[c]});return this};m.prototype.clone=function(){return(new this.constructor).copy(this)};Object.defineProperties(m.prototype,p);return m}(A.Mesh);l.forEach(function(a){var b="_private_"+a;Object.defineProperty(t.prototype,a,{get:function(){return this[b]},set:function(a){a!==this[b]&&(this[b]=a,this._needsSync=
!0)}})});var m=!1;Object.defineProperty(t.prototype,"anchor",{get:function(){return this._deprecated_anchor},set:function(a){this._deprecated_anchor=a;m||(console.warn("TextMesh: `anchor` has been deprecated; use `anchorX` and `anchorY` instead."),m=!0);Array.isArray(a)?(this.anchorX=100*(+a[0]||0)+"%",this.anchorY=100*(+a[1]||0)+"%"):this.anchorX=this.anchorY=0}});return t}();var la=new WeakMap,ja=new WeakMap;B.GlyphsGeometry=ka;B.Text=J;B.configureTextBuilder=function(r){W?console.warn("configureTextBuilder called after first font request; will be ignored."):
aa(I,r)};B.createTextDerivedMaterial=ca;B.fontProcessorWorkerModule=P;B.getCaretAtPoint=function(r,g,b){var a=null,c=r.caretHeight;r=pa(r);var d=Infinity;r.forEach(function(a,f){Math.abs(b-(f+c/2))<Math.abs(b-(d+c/2))&&(d=f)});r.get(d).forEach(function(b){if(!a||Math.abs(g-b.x)<Math.abs(g-a.x))a=b});return a};B.getSelectionRects=function(r,g,b){if(r){var a=la.get(r);if(a&&a.start===g&&a.end===b)return a.rects;a=r.caretPositions;var c=r.caretHeight,d=r.blockBounds;if(b<g){var e=g;g=b;b=e}g=Math.max(g,
0);b=Math.min(b,a.length+1);e=new Map;for(var f=g;f<b;f++){var h=a[3*f],k=a[3*f+1],l=a[3*f+2],n=e.get(l);n?(n.left=Math.max(Math.min(n.left,h),d[0]),n.right=Math.min(Math.max(n.right,k),d[2])):(n={left:h,right:k,bottom:l,top:l+c},e.set(l,n))}var t=[];e.forEach(function(a){t.push(a)});la.set(r,{start:g,end:b,rects:t})}return t};B.preloadFont=function(r,g){var b=r.font,a=r.characters;r=r.sdfGlyphSize;a=Array.isArray(a)?a.join("\n"):""+a;Z({font:b,sdfGlyphSize:r,text:a},g)};Object.defineProperty(B,"__esModule",
{value:!0})})
