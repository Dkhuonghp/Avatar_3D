{"ast":null,"code":"import _createForOfIteratorHelper from \"/Users/khuong/Downloads/avatar-homepage-demo-forked/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _construct from \"/Users/khuong/Downloads/avatar-homepage-demo-forked/node_modules/@babel/runtime/helpers/esm/construct.js\";\nimport _objectWithoutProperties from \"/Users/khuong/Downloads/avatar-homepage-demo-forked/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";\nimport _toConsumableArray from \"/Users/khuong/Downloads/avatar-homepage-demo-forked/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _toArray from \"/Users/khuong/Downloads/avatar-homepage-demo-forked/node_modules/@babel/runtime/helpers/esm/toArray.js\";\nimport _slicedToArray from \"/Users/khuong/Downloads/avatar-homepage-demo-forked/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _objectSpread from \"/Users/khuong/Downloads/avatar-homepage-demo-forked/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nvar _excluded = [\"args\"],\n    _excluded2 = [\"args\"],\n    _excluded3 = [\"args\"],\n    _excluded4 = [\"filter\", \"computeOffsets\"],\n    _excluded5 = [\"ready\", \"manual\", \"vr\", \"noEvents\", \"invalidateFrameloop\", \"frames\", \"subscribers\", \"captured\", \"initialClick\", \"initialHits\"],\n    _excluded6 = [\"children\", \"setEvents\", \"container\", \"renderer\", \"effects\"],\n    _excluded7 = [\"renderer\", \"effects\", \"children\", \"vr\", \"webgl1\", \"concurrent\", \"shadowMap\", \"colorManagement\", \"orthographic\", \"invalidateFrameloop\", \"updateDefaultCamera\", \"noEvents\", \"gl\", \"camera\", \"raycaster\", \"pixelRatio\", \"onCreated\", \"onPointerMissed\", \"preRender\", \"resize\", \"style\"],\n    _excluded8 = [\"onGotPointerCaptureLegacy\"],\n    _excluded9 = [\"children\"];\nimport _extends from '@babel/runtime/helpers/esm/extends';\nimport * as THREE from 'three';\nimport { Layers, Color, Texture, sRGBEncoding, Vector2, Raycaster, Scene, OrthographicCamera, PerspectiveCamera, Clock, Vector3, PCFSoftShadowMap, ACESFilmicToneMapping, WebGL1Renderer, WebGLRenderer } from 'three';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\nimport React, { createContext, useState, useRef, useCallback, useMemo, useLayoutEffect, useEffect, createElement, useContext as useContext$1 } from 'react';\nimport { TinyEmitter } from 'tiny-emitter';\nimport { useAsset } from 'use-asset';\nimport useMeasure from 'react-use-measure';\nimport mergeRefs from 'react-merge-refs';\nvar name = \"react-three-fiber\";\nvar version = \"5.3.7\";\nvar roots = new Map();\nvar emptyObject = {};\nvar is = {\n  obj: function obj(a) {\n    return a === Object(a) && !is.arr(a);\n  },\n  fun: function fun(a) {\n    return typeof a === 'function';\n  },\n  str: function str(a) {\n    return typeof a === 'string';\n  },\n  num: function num(a) {\n    return typeof a === 'number';\n  },\n  und: function und(a) {\n    return a === void 0;\n  },\n  arr: function arr(a) {\n    return Array.isArray(a);\n  },\n  equ: function equ(a, b) {\n    // Wrong type or one of the two undefined, doesn't match\n    if (typeof a !== typeof b || !!a !== !!b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    var i;\n\n    for (i in a) {\n      if (!(i in b)) return false;\n    }\n\n    for (i in b) {\n      if (a[i] !== b[i]) return false;\n    }\n\n    return is.und(i) ? a === b : true;\n  }\n};\n\nfunction createSubs(callback, subs) {\n  var index = subs.length;\n  subs.push(callback);\n  return function () {\n    return void subs.splice(index, 1);\n  };\n}\n\nvar globalEffects = [];\nvar globalAfterEffects = [];\nvar globalTailEffects = [];\n\nvar addEffect = function addEffect(callback) {\n  return createSubs(callback, globalEffects);\n};\n\nvar addAfterEffect = function addAfterEffect(callback) {\n  return createSubs(callback, globalAfterEffects);\n};\n\nvar addTail = function addTail(callback) {\n  return createSubs(callback, globalTailEffects);\n};\n\nfunction renderGl(state, timestamp) {\n  var repeat = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  var runGlobalEffects = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  var i; // Run global effects\n\n  if (runGlobalEffects) {\n    for (i = 0; i < globalEffects.length; i++) {\n      globalEffects[i](timestamp);\n      repeat++;\n    }\n  } // Run local effects\n\n\n  var delta = state.current.clock.getDelta();\n\n  for (i = 0; i < state.current.subscribers.length; i++) {\n    state.current.subscribers[i].ref.current(state.current, delta);\n  } // Decrease frame count\n\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual && state.current.gl.render) state.current.gl.render(state.current.scene, state.current.camera); // Run global after-effects\n\n  if (runGlobalEffects) {\n    for (i = 0; i < globalAfterEffects.length; i++) {\n      globalAfterEffects[i](timestamp);\n    }\n  }\n\n  return repeat;\n}\n\nvar running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  var repeat = 0;\n  var i; // Run global effects\n\n  for (i = 0; i < globalEffects.length; i++) {\n    globalEffects[i](timestamp);\n    repeat++;\n  }\n\n  roots.forEach(function (root) {\n    var state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) {\n      repeat = renderGl(state, timestamp, repeat);\n    }\n  }); // Run global after-effects\n\n  for (i = 0; i < globalAfterEffects.length; i++) {\n    globalAfterEffects[i](timestamp);\n  }\n\n  if (repeat !== 0) {\n    return requestAnimationFrame(renderLoop);\n  } else {\n    // Tail call effects, they are called when rendering stops\n    for (i = 0; i < globalTailEffects.length; i++) {\n      globalTailEffects[i](timestamp);\n    }\n  } // Flag end of operation\n\n\n  running = false;\n}\n\nfunction _invalidate() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n  var frames = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n\n  if (state === true) {\n    roots.forEach(function (root) {\n      var state = root.containerInfo.__state;\n      state.current.frames = state.current.ready ? state.current.frames + frames : frames;\n    });\n  } else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = state.current.ready ? state.current.frames + frames : frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\n\nfunction forceResize() {\n  roots.forEach(function (root) {\n    return root.containerInfo.__state.current.forceResize();\n  });\n}\n\nvar catalogue = {};\n\nvar extend = function extend(objects) {\n  return void (catalogue = _objectSpread(_objectSpread({}, catalogue), objects));\n};\n\nfunction applyProps(instance, newProps) {\n  var oldProps = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var accumulative = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  // Filter equals, events and reserved props\n  var container = instance.__container;\n  var sameProps = [];\n  var handlers = [];\n  var i;\n  var keys = Object.keys(newProps);\n\n  for (i = 0; i < keys.length; i++) {\n    if (is.equ(newProps[keys[i]], oldProps[keys[i]])) {\n      sameProps.push(keys[i]);\n    } // Event-handlers ...\n    //   are functions, that\n    //   start with \"on\", and\n    //   contain the name \"Pointer\", \"Click\", \"ContextMenu\", or \"Wheel\"\n\n\n    if (is.fun(newProps[keys[i]]) && keys[i].startsWith('on')) {\n      if (keys[i].includes('Pointer') || keys[i].includes('Click') || keys[i].includes('ContextMenu') || keys[i].includes('Wheel')) {\n        handlers.push(keys[i]);\n      }\n    }\n  }\n\n  var leftOvers = [];\n  keys = Object.keys(oldProps);\n\n  if (accumulative) {\n    for (i = 0; i < keys.length; i++) {\n      if (newProps[keys[i]] === void 0) {\n        leftOvers.push(keys[i]);\n      }\n    }\n  }\n\n  var toFilter = [].concat(sameProps, ['children', 'key', 'ref']); // Instances use \"object\" as a reserved identifier\n\n  if (instance.__instance) toFilter.push('object');\n\n  var filteredProps = _objectSpread({}, newProps); // Removes sameProps and reserved props from newProps\n\n\n  keys = Object.keys(filteredProps);\n\n  for (i = 0; i < keys.length; i++) {\n    if (toFilter.indexOf(keys[i]) > -1) {\n      delete filteredProps[keys[i]];\n    }\n  } // Add left-overs as undefined props so they can be removed\n\n\n  keys = Object.keys(leftOvers);\n\n  for (i = 0; i < keys.length; i++) {\n    if (keys[i] !== 'children') {\n      filteredProps[keys[i]] = undefined;\n    }\n  }\n\n  var filteredPropsEntries = Object.entries(filteredProps);\n\n  if (filteredPropsEntries.length > 0) {\n    filteredPropsEntries.forEach(function (_ref) {\n      var _ref2 = _slicedToArray(_ref, 2),\n          key = _ref2[0],\n          value = _ref2[1];\n\n      if (!handlers.includes(key)) {\n        var _instance$__container, _instance$__container2;\n\n        var root = instance;\n        var target = root[key];\n\n        if (key.includes('-')) {\n          var entries = key.split('-');\n          target = entries.reduce(function (acc, key) {\n            return acc[key];\n          }, instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            var _entries$reverse = entries.reverse(),\n                _entries$reverse2 = _toArray(_entries$reverse),\n                _name = _entries$reverse2[0],\n                reverseEntries = _entries$reverse2.slice(1);\n\n            root = reverseEntries.reverse().reduce(function (acc, key) {\n              return acc[key];\n            }, instance);\n            key = _name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        var isColorManagement = (_instance$__container = instance.__container) == null ? void 0 : (_instance$__container2 = _instance$__container.__state) == null ? void 0 : _instance$__container2.current.colorManagement;\n\n        if (target && target.set && (target.copy || target instanceof Layers)) {\n          // If value is an array it has got to be the set function\n          if (Array.isArray(value)) {\n            var _target;\n\n            (_target = target).set.apply(_target, _toConsumableArray(value));\n          } // Test again target.copy(class) next ...\n          else if (target.copy && value && value.constructor && target.constructor.name === value.constructor.name) {\n            target.copy(value);\n          } // If nothing else fits, just set the single value, ignore undefined\n          // https://github.com/react-spring/react-three-fiber/issues/274\n          else if (value !== undefined) {\n            target.set(value); // Auto-convert sRGB colors, for now ...\n            // https://github.com/react-spring/react-three-fiber/issues/344\n\n            if (isColorManagement && target instanceof Color) {\n              target.convertSRGBToLinear();\n            }\n          } // Else, just overwrite the value\n\n        } else {\n          root[key] = value; // Auto-convert sRGB textures, for now ...\n          // https://github.com/react-spring/react-three-fiber/issues/344\n\n          if (isColorManagement && root[key] instanceof Texture) {\n            root[key].encoding = sRGBEncoding;\n          }\n        }\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      var index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      if (accumulative && container && instance.raycast) container.__interaction.push(instance); // Add handlers to the instances handler-map\n\n      instance.__handlers = handlers.reduce(function (acc, key) {\n        acc[key.charAt(2).toLowerCase() + key.substr(3)] = newProps[key];\n        return acc;\n      }, {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) _invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.onUpdate) instance.onUpdate(instance);\n}\n\nfunction createInstance(type, _ref3, container, hostContext, internalInstanceHandle) {\n  var _ref3$args = _ref3.args,\n      args = _ref3$args === void 0 ? [] : _ref3$args,\n      props = _objectWithoutProperties(_ref3, _excluded);\n\n  var name = \"\".concat(type[0].toUpperCase()).concat(type.slice(1));\n  var instance;\n\n  if (type === 'primitive') {\n    // Switch off dispose for primitive objects\n    props = _objectSpread({\n      dispose: null\n    }, props);\n    instance = props.object;\n    instance.__instance = true;\n    instance.__dispose = instance.dispose;\n  } else {\n    var target = catalogue[name] || THREE[name];\n\n    if (!target) {\n      throw \"\\\"\".concat(name, \"\\\" is not part of the THREE namespace! Did you forget to extend it? See: https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#using-3rd-party-objects-declaratively\");\n    }\n\n    instance = is.arr(args) ? _construct(target, _toConsumableArray(args)) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // TODO: https://github.com/facebook/react/issues/17147\n  // If it's still not there it means the portal was created on a virtual node outside of react\n\n\n  if (!roots.has(container)) {\n    var fn = function fn(node) {\n      if (!node.return) return node.stateNode && node.stateNode.containerInfo;else return fn(node.return);\n    };\n\n    container = fn(internalInstanceHandle);\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // Auto-attach geometries and materials\n\n  if (name.endsWith('Geometry')) {\n    props = _objectSpread({\n      attach: 'geometry'\n    }, props);\n  } else if (name.endsWith('Material')) {\n    props = _objectSpread({\n      attach: 'material'\n    }, props);\n  } // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"true\" here\n\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.add(child);\n    } else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      } else if (child.attach) {\n        parentInstance[child.attach] = child;\n      }\n    }\n\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      });\n      var restSiblings = parentInstance.children.filter(function (sibling) {\n        return sibling !== child;\n      }); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      var index = restSiblings.indexOf(beforeChild);\n      parentInstance.children = [].concat(_toConsumableArray(restSiblings.slice(0, index)), [child], _toConsumableArray(restSiblings.slice(index)));\n      updateInstance(child);\n    } else {\n      appendChild(parentInstance, child);\n    } // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent) {\n  var clone = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    var target = clone ? _toConsumableArray(array) : array;\n    target.forEach(function (child) {\n      return removeChild(parent, child);\n    });\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      if (parentInstance.__objects) parentInstance.__objects = parentInstance.__objects.filter(function (x) {\n        return x !== child;\n      }); // Remove attachment\n\n      if (child.attachArray) {\n        parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(function (x) {\n          return x !== child;\n        });\n      } else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      } else if (child.attach) {\n        parentInstance[child.attach] = null;\n      }\n    } // Remove interactivity\n\n\n    if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(function (x) {\n      return x !== child;\n    });\n    invalidateInstance(child); // Allow objects to bail out of recursive dispose alltogether by passing dispose={null}\n\n    if (child.dispose !== null) {\n      unstable_runWithPriority(unstable_IdlePriority, function () {\n        // Remove nested child objects\n        removeRecursive(child.__objects, child);\n        removeRecursive(child.children, child, true); // Dispose item\n\n        if (child.dispose && child.type !== 'Scene') child.dispose();else if (child.__dispose) child.__dispose(); // Remove references\n\n        delete child.__container;\n        delete child.__objects;\n      });\n    }\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  var parent = instance.parent;\n  var newInstance = createInstance(type, newProps, instance.__container, null, fiber);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(function (fiber) {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (is.fun(fiber.ref)) fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nvar Renderer = Reconciler({\n  now: unstable_now,\n  createInstance: createInstance,\n  removeChild: removeChild,\n  appendChild: appendChild,\n  insertBefore: insertBefore,\n  warnsIfNotActing: true,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  scheduleTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  cancelTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  // @ts-ignore\n  setTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  // @ts-ignore\n  clearTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  noTimeout: -1,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n  commitUpdate: function commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else {\n      // This is a data object, let's extract critical information about it\n      var _newProps$args = newProps.args,\n          argsNew = _newProps$args === void 0 ? [] : _newProps$args,\n          restNew = _objectWithoutProperties(newProps, _excluded2);\n\n      var _oldProps$args = oldProps.args,\n          argsOld = _oldProps$args === void 0 ? [] : _oldProps$args,\n          restOld = _objectWithoutProperties(oldProps, _excluded3); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n      var hasNewArgs = argsNew.some(function (value, index) {\n        return is.obj(value) ? Object.entries(value).some(function (_ref4) {\n          var _ref5 = _slicedToArray(_ref4, 2),\n              key = _ref5[0],\n              val = _ref5[1];\n\n          return val !== argsOld[index][key];\n        }) : value !== argsOld[index];\n      });\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n  hideInstance: function hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n  unhideInstance: function unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n  hideTextInstance: function hideTextInstance() {\n    throw new Error('Text is not allowed in the react-three-fibre tree. You may have extraneous whitespace between components.');\n  },\n  getPublicInstance: function getPublicInstance(instance) {\n    return instance;\n  },\n  getRootHostContext: function getRootHostContext() {\n    return emptyObject;\n  },\n  getChildHostContext: function getChildHostContext() {\n    return emptyObject;\n  },\n  createTextInstance: function createTextInstance() {},\n  finalizeInitialChildren: function finalizeInitialChildren(instance) {\n    // https://github.com/facebook/react/issues/20271\n    // Returning true will trigger commitMount\n    return instance.__handlers;\n  },\n  commitMount: function commitMount(instance)\n  /*, type, props*/\n  {\n    // https://github.com/facebook/react/issues/20271\n    // This will make sure events are only added once to the central container\n    var container = instance.__container;\n    if (container && instance.raycast && instance.__handlers) container.__interaction.push(instance);\n  },\n  prepareUpdate: function prepareUpdate() {\n    return emptyObject;\n  },\n  shouldDeprioritizeSubtree: function shouldDeprioritizeSubtree() {\n    return false;\n  },\n  prepareForCommit: function prepareForCommit() {\n    return null;\n  },\n  preparePortalMount: function preparePortalMount() {\n    return null;\n  },\n  resetAfterCommit: function resetAfterCommit() {},\n  shouldSetTextContent: function shouldSetTextContent() {\n    return false;\n  },\n  clearContainer: function clearContainer() {\n    return false;\n  }\n});\nvar hasSymbol = is.fun(Symbol) && Symbol.for;\nvar REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca;\n\nfunction render(element, container, state) {\n  var root = roots.get(container);\n\n  if (!root) {\n    container.__state = state; // @ts-ignore\n\n    var newRoot = root = Renderer.createContainer(container, state !== undefined && state.current.concurrent ? 2 : 0, false, // @ts-ignore\n    null);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, function () {\n    return undefined;\n  });\n  return Renderer.getPublicRootInstance(root);\n}\n\nfunction unmountComponentAtNode(container, callback) {\n  var root = roots.get(container);\n\n  if (root) {\n    Renderer.updateContainer(null, root, null, function () {\n      roots.delete(container);\n      if (callback) callback(container);\n    });\n  }\n}\n\nfunction createPortal(children, containerInfo, implementation) {\n  var key = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n  if (!containerInfo.__objects) containerInfo.__objects = [];\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children: children,\n    containerInfo: containerInfo,\n    implementation: implementation\n  };\n}\n\nRenderer.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  //@ts-ignore\n  findHostInstanceByFiber: function findHostInstanceByFiber() {\n    return null;\n  },\n  version: version,\n  rendererPackageName: name\n});\nvar threeTypes = /*#__PURE__*/Object.freeze({\n  __proto__: null\n});\n\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index;\n}\n\nvar stateContext = /*#__PURE__*/createContext({});\n\nvar useCanvas = function useCanvas(props) {\n  var children = props.children,\n      gl = props.gl,\n      camera = props.camera,\n      orthographic = props.orthographic,\n      raycaster = props.raycaster,\n      size = props.size,\n      pixelRatio = props.pixelRatio,\n      _props$vr = props.vr,\n      vr = _props$vr === void 0 ? false : _props$vr,\n      _props$concurrent = props.concurrent,\n      concurrent = _props$concurrent === void 0 ? false : _props$concurrent,\n      _props$shadowMap = props.shadowMap,\n      shadowMap = _props$shadowMap === void 0 ? false : _props$shadowMap,\n      _props$colorManagemen = props.colorManagement,\n      colorManagement = _props$colorManagemen === void 0 ? true : _props$colorManagemen,\n      _props$invalidateFram = props.invalidateFrameloop,\n      invalidateFrameloop = _props$invalidateFram === void 0 ? false : _props$invalidateFram,\n      _props$updateDefaultC = props.updateDefaultCamera,\n      updateDefaultCamera = _props$updateDefaultC === void 0 ? true : _props$updateDefaultC,\n      _props$noEvents = props.noEvents,\n      noEvents = _props$noEvents === void 0 ? false : _props$noEvents,\n      onCreated = props.onCreated,\n      onPointerMissed = props.onPointerMissed,\n      forceResize = props.forceResize; // Local, reactive state\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      ready = _useState2[0],\n      setReady = _useState2[1];\n\n  var _useState3 = useState(function () {\n    return new Vector2();\n  }),\n      _useState4 = _slicedToArray(_useState3, 1),\n      mouse = _useState4[0];\n\n  var _useState5 = useState(function () {\n    var ray = new Raycaster();\n\n    if (raycaster) {\n      var filter = raycaster.filter,\n          computeOffsets = raycaster.computeOffsets,\n          raycasterProps = _objectWithoutProperties(raycaster, _excluded4);\n\n      applyProps(ray, raycasterProps, {});\n    }\n\n    return ray;\n  }),\n      _useState6 = _slicedToArray(_useState5, 1),\n      defaultRaycaster = _useState6[0];\n\n  var _useState7 = useState(function () {\n    var scene = new Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  }),\n      _useState8 = _slicedToArray(_useState7, 1),\n      defaultScene = _useState8[0];\n\n  var _useState9 = useState(function () {\n    var cam = orthographic ? new OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {}); // Always look at [0, 0, 0]\n\n    cam.lookAt(0, 0, 0);\n    return cam;\n  }),\n      _useState10 = _slicedToArray(_useState9, 2),\n      defaultCam = _useState10[0],\n      _setDefaultCamera = _useState10[1];\n\n  var _useState11 = useState(function () {\n    return new Clock();\n  }),\n      _useState12 = _slicedToArray(_useState11, 1),\n      clock = _useState12[0]; // Public state\n\n\n  var state = useRef({\n    ready: false,\n    active: true,\n    manual: 0,\n    colorManagement: colorManagement,\n    vr: vr,\n    concurrent: concurrent,\n    noEvents: noEvents,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse: mouse,\n    clock: clock,\n    gl: gl,\n    size: size,\n    viewport: null,\n    initialClick: [0, 0],\n    initialHits: [],\n    pointer: new TinyEmitter(),\n    captured: undefined,\n    events: undefined,\n    subscribe: function subscribe(ref) {\n      var priority = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      // If this subscription was given a priority, it takes rendering into its own hands\n      // For that reason we switch off automatic rendering and increase the manual flag\n      // As long as this flag is positive (there could be multiple render subscription)\n      // ..there can be no internal rendering at all\n      if (priority) state.current.manual++;\n      state.current.subscribers.push({\n        ref: ref,\n        priority: priority\n      }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n      state.current.subscribers = state.current.subscribers.sort(function (a, b) {\n        return a.priority - b.priority;\n      });\n      return function () {\n        var _state$current;\n\n        if ((_state$current = state.current) != null && _state$current.subscribers) {\n          // Decrease manual flag if this subscription had a priority\n          if (priority) state.current.manual--;\n          state.current.subscribers = state.current.subscribers.filter(function (s) {\n            return s.ref !== ref;\n          });\n        }\n      };\n    },\n    setDefaultCamera: function setDefaultCamera(camera) {\n      return _setDefaultCamera(camera);\n    },\n    invalidate: function invalidate() {\n      return _invalidate(state);\n    },\n    intersect: function intersect() {\n      var event = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var prepare = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      return handlePointerMove(event, prepare);\n    },\n    forceResize: forceResize\n  });\n  var getCurrentViewport = useCallback(function () {\n    var camera = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : state.current.camera;\n    var target = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new Vector3(0, 0, 0);\n    var _state$current$size = state.current.size,\n        width = _state$current$size.width,\n        height = _state$current$size.height;\n    var distance = camera.position.distanceTo(target);\n\n    if (isOrthographicCamera(camera)) {\n      return {\n        width: width / camera.zoom,\n        height: height / camera.zoom,\n        factor: 1,\n        distance: distance\n      };\n    } else {\n      var fov = camera.fov * Math.PI / 180; // convert vertical fov to radians\n\n      var h = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      var w = h * (width / height);\n      return {\n        width: w,\n        height: h,\n        factor: width / w,\n        distance: distance\n      };\n    }\n  }, []); // Writes locals into public state for distribution among subscribers, context, etc\n\n  useMemo(function () {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.gl = gl;\n    state.current.concurrent = concurrent;\n    state.current.noEvents = noEvents; // Make viewport backwards compatible\n\n    state.current.viewport = getCurrentViewport; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [invalidateFrameloop, vr, concurrent, noEvents, ready, size, defaultCam, gl]); // Adjusts default camera\n\n  useMemo(function () {\n    state.current.aspect = size.width / size.height; // Assign viewport props to the function\n\n    Object.assign(state.current.viewport, getCurrentViewport()); // https://github.com/drcmda/react-three-fiber/issues/92\n    // Sometimes automatic default camera adjustment isn't wanted behaviour\n\n    if (updateDefaultCamera) {\n      if (isOrthographicCamera(defaultCam)) {\n        defaultCam.left = size.width / -2;\n        defaultCam.right = size.width / 2;\n        defaultCam.top = size.height / 2;\n        defaultCam.bottom = size.height / -2;\n      } else {\n        defaultCam.aspect = state.current.aspect;\n      }\n\n      defaultCam.updateProjectionMatrix(); // https://github.com/react-spring/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      defaultCam.updateMatrixWorld();\n    }\n\n    gl.setSize(size.width, size.height);\n    if (ready) _invalidate(state); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [defaultCam, gl, size, updateDefaultCamera, ready]); // Only trigger the context provider when necessary\n\n  var sharedState = useRef(null);\n  useMemo(function () {\n    var _state$current2 = state.current,\n        ready = _state$current2.ready,\n        manual = _state$current2.manual,\n        vr = _state$current2.vr,\n        noEvents = _state$current2.noEvents,\n        invalidateFrameloop = _state$current2.invalidateFrameloop,\n        frames = _state$current2.frames,\n        subscribers = _state$current2.subscribers,\n        captured = _state$current2.captured,\n        initialClick = _state$current2.initialClick,\n        initialHits = _state$current2.initialHits,\n        props = _objectWithoutProperties(_state$current2, _excluded5);\n\n    sharedState.current = props; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [size, defaultCam]); // Update pixel ratio\n\n  useLayoutEffect(function () {\n    if (pixelRatio) {\n      if (Array.isArray(pixelRatio)) gl.setPixelRatio(Math.max(Math.min(pixelRatio[0], window.devicePixelRatio), pixelRatio[1]));else gl.setPixelRatio(pixelRatio);\n    }\n  }, [gl, pixelRatio]); // Update shadow map\n\n  useLayoutEffect(function () {\n    if (shadowMap) {\n      gl.shadowMap.enabled = true;\n      if (typeof shadowMap === 'object') Object.assign(gl.shadowMap, shadowMap);else gl.shadowMap.type = PCFSoftShadowMap;\n    }\n\n    if (colorManagement) {\n      gl.toneMapping = ACESFilmicToneMapping;\n      gl.outputEncoding = sRGBEncoding;\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [shadowMap, colorManagement]);\n  /** Events ------------------------------------------------------------------------------------------------ */\n\n  var hovered = useMemo(function () {\n    return new Map();\n  }, []);\n  var temp = new Vector3();\n  /** Sets up defaultRaycaster */\n\n  var prepareRay = useCallback(function (event) {\n    // https://github.com/pmndrs/react-three-fiber/pull/782\n    // Events trigger outside of canvas when moved\n    var offsets = (raycaster == null ? void 0 : raycaster.computeOffsets == null ? void 0 : raycaster.computeOffsets(event, sharedState.current)) || event.nativeEvent;\n\n    if (offsets) {\n      var offsetX = offsets.offsetX,\n          offsetY = offsets.offsetY;\n      var _state$current$size2 = state.current.size,\n          width = _state$current$size2.width,\n          height = _state$current$size2.height;\n      mouse.set(offsetX / width * 2 - 1, -(offsetY / height) * 2 + 1);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  var intersect = useCallback(function (event, filter) {\n    // Skip event handling when noEvents is set\n    if (state.current.noEvents) return [];\n    var seen = new Set();\n    var hits = []; // Allow callers to eliminate event objects\n\n    var eventsObjects = filter ? filter(state.current.scene.__interaction) : state.current.scene.__interaction; // Intersect known handler objects and filter against duplicates\n\n    var intersects = defaultRaycaster.intersectObjects(eventsObjects, true).filter(function (item) {\n      var id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // https://github.com/mrdoob/three.js/issues/16031\n    // Allow custom userland intersect sort order\n\n    if (raycaster && raycaster.filter && sharedState.current) {\n      intersects = raycaster.filter(intersects, sharedState.current);\n    }\n\n    var _iterator = _createForOfIteratorHelper(intersects),\n        _step;\n\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var _intersect = _step.value;\n        var eventObject = _intersect.object; // Bubble event up\n\n        while (eventObject) {\n          var handlers = eventObject.__handlers;\n          if (handlers) hits.push(_objectSpread(_objectSpread({}, _intersect), {}, {\n            eventObject: eventObject\n          }));\n          eventObject = eventObject.parent;\n        }\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n\n    return hits;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  /**  Calculates click deltas */\n\n  var calculateDistance = useCallback(function (event) {\n    var dx = event.nativeEvent.offsetX - state.current.initialClick[0];\n    var dy = event.nativeEvent.offsetY - state.current.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }, []);\n  var handlePointerCancel = useCallback(function (event, hits) {\n    var prepare = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n    state.current.pointer.emit('pointerCancel', event);\n    if (prepare) prepareRay(event);\n    Array.from(hovered.values()).forEach(function (data) {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (hits && (!hits.length || !hits.find(function (i) {\n        return i.eventObject === data.eventObject && i.index === data.index;\n      }))) {\n        var eventObject = data.eventObject;\n        var handlers = eventObject.__handlers;\n        hovered.delete(makeId(data));\n\n        if (handlers) {\n          if (handlers.pointerOut) handlers.pointerOut(_objectSpread(_objectSpread({}, data), {}, {\n            type: 'pointerout'\n          }));\n          if (handlers.pointerLeave) handlers.pointerLeave(_objectSpread(_objectSpread({}, data), {}, {\n            type: 'pointerleave'\n          }));\n        }\n      }\n    }); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  /**  Creates filtered intersects and returns an array of positive hits */\n\n  var getIntersects = useCallback(function (event, filter) {\n    // Get fresh intersects\n    var intersections = intersect(event, filter); // If the interaction is captured take that into account, the captured event has to be part of the intersects\n\n    if (state.current.captured && event.type !== 'click' && event.type !== 'wheel') {\n      state.current.captured.forEach(function (captured) {\n        if (!intersections.find(function (hit) {\n          return hit.eventObject === captured.eventObject;\n        })) intersections.push(captured);\n      });\n    }\n\n    return intersections;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  var handleIntersects = useCallback(function (intersections, event, fn) {\n    // If anything has been found, forward it to the event listeners\n    if (intersections.length) {\n      (function () {\n        var unprojectedPoint = temp.set(mouse.x, mouse.y, 0).unproject(state.current.camera);\n        var delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n        var releasePointerCapture = function releasePointerCapture(id) {\n          return event.target.releasePointerCapture(id);\n        };\n\n        var localState = {\n          stopped: false,\n          captured: false\n        };\n\n        var _iterator2 = _createForOfIteratorHelper(intersections),\n            _step2;\n\n        try {\n          var _loop = function _loop() {\n            var hit = _step2.value;\n\n            var setPointerCapture = function setPointerCapture(id) {\n              // If the hit is going to be captured flag that we're in captured state\n              if (!localState.captured) {\n                localState.captured = true; // The captured hit array is reset to collect hits\n\n                state.current.captured = [];\n              } // Push hits to the array\n\n\n              if (state.current.captured) {\n                state.current.captured.push(hit);\n              } // Call the original event now\n\n\n              event.target.setPointerCapture(id);\n            };\n\n            var raycastEvent = _objectSpread(_objectSpread(_objectSpread({}, event), hit), {}, {\n              intersections: intersections,\n              stopped: localState.stopped,\n              delta: delta,\n              unprojectedPoint: unprojectedPoint,\n              ray: defaultRaycaster.ray,\n              camera: state.current.camera,\n              // Hijack stopPropagation, which just sets a flag\n              stopPropagation: function stopPropagation() {\n                // https://github.com/react-spring/react-three-fiber/issues/596\n                // Events are not allowed to stop propagation if the pointer has been captured\n                var cap = state.current.captured;\n\n                if (!cap || cap.find(function (h) {\n                  return h.eventObject.id === hit.eventObject.id;\n                })) {\n                  raycastEvent.stopped = localState.stopped = true; // Propagation is stopped, remove all other hover records\n                  // An event handler is only allowed to flush other handlers if it is hovered itself\n\n                  if (hovered.size && Array.from(hovered.values()).find(function (i) {\n                    return i.object === hit.object;\n                  })) {\n                    // Objects cannot flush out higher up objects that have already caught the event\n                    var higher = intersections.slice(0, intersections.indexOf(hit));\n                    handlePointerCancel(raycastEvent, [].concat(_toConsumableArray(higher), [hit]));\n                  }\n                }\n              },\n              target: _objectSpread(_objectSpread({}, event.target), {}, {\n                setPointerCapture: setPointerCapture,\n                releasePointerCapture: releasePointerCapture\n              }),\n              currentTarget: _objectSpread(_objectSpread({}, event.currentTarget), {}, {\n                setPointerCapture: setPointerCapture,\n                releasePointerCapture: releasePointerCapture\n              }),\n              sourceEvent: event\n            });\n\n            fn(raycastEvent); // Event bubbling may be interrupted by stopPropagation\n\n            if (localState.stopped === true) return \"break\";\n          };\n\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var _ret = _loop();\n\n            if (_ret === \"break\") break;\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n      })();\n    }\n\n    return intersections;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  var handlePointerMove = useCallback(function (event) {\n    var prepare = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n    state.current.pointer.emit('pointerMove', event);\n    if (prepare) prepareRay(event);\n    var hits = getIntersects(event, // This is onPointerMove, we're only interested in events that exhibit this particular event\n    function (objects) {\n      return objects.filter(function (obj) {\n        return ['Move', 'Over', 'Enter', 'Out', 'Leave'].some(function (name) {\n          return obj.__handlers['pointer' + name];\n        });\n      });\n    }); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    handleIntersects(hits, event, function (data) {\n      var eventObject = data.eventObject;\n      var handlers = eventObject.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerEnter || handlers.pointerOut || handlers.pointerLeave) {\n        var id = makeId(data);\n        var hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver(_objectSpread(_objectSpread({}, data), {}, {\n            type: 'pointerover'\n          }));\n          if (handlers.pointerEnter) handlers.pointerEnter(_objectSpread(_objectSpread({}, data), {}, {\n            type: 'pointerenter'\n          }));\n        } else if (hoveredItem.stopped) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation();\n        }\n      } // Call mouse move\n\n\n      if (handlers.pointerMove) handlers.pointerMove(data);\n    });\n    return hits; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  var handlePointer = useCallback(function (name) {\n    return function (event) {\n      var prepare = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      state.current.pointer.emit(name, event);\n      if (prepare) prepareRay(event);\n      var hits = getIntersects(event);\n      handleIntersects(hits, event, function (data) {\n        var eventObject = data.eventObject;\n        var handlers = eventObject.__handlers;\n\n        if (handlers && handlers[name]) {\n          // Forward all events back to their respective handlers with the exception of click events,\n          // which must use the initial target\n          if (name !== 'click' && name !== 'contextMenu' && name !== 'doubleClick' || state.current.initialHits.includes(eventObject)) {\n            handlers[name](data);\n            pointerMissed(event, defaultScene.__interaction, function (object) {\n              return object !== eventObject;\n            });\n          }\n        }\n      }); // If a click yields no results, pass it back to the user as a miss\n\n      if (name === 'pointerDown') {\n        state.current.initialClick = [event.nativeEvent.offsetX, event.nativeEvent.offsetY];\n        state.current.initialHits = hits.map(function (hit) {\n          return hit.eventObject;\n        });\n      }\n\n      if ((name === 'click' || name === 'contextMenu' || name === 'doubleClick') && !hits.length) {\n        if (calculateDistance(event) <= 2) {\n          pointerMissed(event, defaultScene.__interaction);\n          if (onPointerMissed) onPointerMissed();\n        }\n      }\n    };\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  [onPointerMissed, calculateDistance, getIntersects, handleIntersects, prepareRay]);\n  useMemo(function () {\n    state.current.events = {\n      onClick: handlePointer('click'),\n      onContextMenu: handlePointer('contextMenu'),\n      onDoubleClick: handlePointer('doubleClick'),\n      onWheel: handlePointer('wheel'),\n      onPointerDown: handlePointer('pointerDown'),\n      onPointerUp: handlePointer('pointerUp'),\n      onPointerLeave: function onPointerLeave(e) {\n        return handlePointerCancel(e, []);\n      },\n      onPointerMove: handlePointerMove,\n      // onGotPointerCapture is not needed any longer because the behaviour is hacked into\n      // the event itself (see handleIntersects). But in order for non-web targets to simulate\n      // it we keep the legacy event, which simply flags all current intersects as captured\n      onGotPointerCaptureLegacy: function onGotPointerCaptureLegacy(e) {\n        return state.current.captured = intersect(e);\n      },\n      onLostPointerCapture: function onLostPointerCapture(e) {\n        return state.current.captured = undefined, handlePointerCancel(e);\n      }\n    };\n  }, [handlePointer, intersect, handlePointerCancel, handlePointerMove]);\n  /** Events ------------------------------------------------------------------------------------------------- */\n  // This component is a bridge into the three render context, when it gets rendered\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  var Canvas = useCallback(function Canvas(props) {\n    var activate = function activate() {\n      return setReady(true);\n    };\n\n    useEffect(function () {\n      var result = onCreated && onCreated(state.current);\n      if (result && result.then) result.then(activate);else activate();\n    }, []);\n    return props.children;\n  }, // The Canvas component has to be static, it should not be re-created ever\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  []); // Render v-dom into scene\n\n  useLayoutEffect(function () {\n    render( /*#__PURE__*/createElement(Canvas, null, /*#__PURE__*/createElement(stateContext.Provider, {\n      value: sharedState.current\n    }, typeof children === 'function' ? children(state.current) : children)), defaultScene, state); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [ready, children, sharedState.current]);\n  useLayoutEffect(function () {\n    if (ready) {\n      // Start render-loop, either via RAF or setAnimationLoop for VR\n      if (!state.current.vr) {\n        if (state.current.frames === 0) _invalidate(state);\n      } else if ((gl.xr || gl.vr) && gl.setAnimationLoop) {\n        (gl.xr || gl.vr).enabled = true;\n        gl.setAnimationLoop(function (t) {\n          return renderGl(state, t, 0, true);\n        });\n      } else {\n        console.warn('the gl instance does not support VR!');\n      }\n    }\n  }, [gl, ready, invalidateFrameloop]); // Dispose renderer on unmount\n\n  useEffect(function () {\n    return function () {\n      if (state.current.gl) {\n        if (state.current.gl.renderLists) state.current.gl.renderLists.dispose();\n        if (state.current.gl.forceContextLoss) state.current.gl.forceContextLoss();\n        dispose(state.current.gl);\n      }\n\n      unmountComponentAtNode(state.current.scene, function () {\n        dispose(state.current.raycaster);\n        dispose(state.current.camera);\n        dispose(state.current);\n      });\n    };\n  }, []);\n  return state.current.events;\n};\n\nfunction pointerMissed(event, objects) {\n  var filter = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function (object) {\n    return true;\n  };\n  objects.filter(filter).forEach(function (object) {\n    var _handlers$pointerMis, _handlers;\n\n    return (_handlers$pointerMis = (_handlers = object.__handlers).pointerMissed) == null ? void 0 : _handlers$pointerMis.call(_handlers, event);\n  });\n}\n\nfunction dispose(obj) {\n  if (obj.dispose && obj.type !== 'Scene') obj.dispose();\n\n  for (var p in obj) {\n    if (typeof p === 'object' && p.dispose) p.dispose();\n    delete obj[p];\n  }\n}\n\nfunction useContext(context) {\n  var result = useContext$1(context);\n\n  if (!('subscribe' in result)) {\n    throw new Error(\"\\u26A1\\uFE0F react-three-fiber hooks can only be used within the Canvas component! https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#hooks\");\n  }\n\n  return result;\n}\n\nfunction useFrame(callback) {\n  var renderPriority = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n  var _useContext = useContext(stateContext),\n      subscribe = _useContext.subscribe; // Update ref\n\n\n  var ref = useRef(callback);\n  useLayoutEffect(function () {\n    return void (ref.current = callback);\n  }, [callback]); // Subscribe/unsub\n\n  useEffect(function () {\n    var unsubscribe = subscribe(ref, renderPriority);\n    return function () {\n      return unsubscribe();\n    };\n  }, [renderPriority, subscribe]);\n  return null;\n}\n\nfunction useThree() {\n  return useContext(stateContext);\n}\n\nfunction useUpdate(callback, dependents, optionalRef) {\n  var _useContext2 = useContext(stateContext),\n      invalidate = _useContext2.invalidate;\n\n  var localRef = useRef();\n  var ref = optionalRef ? optionalRef : localRef;\n  useLayoutEffect(function () {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents); // eslint-disable-line react-hooks/exhaustive-deps\n\n  return ref;\n}\n\nfunction useResource(optionalRef) {\n  var _useState13 = useState(false),\n      _useState14 = _slicedToArray(_useState13, 2),\n      _ = _useState14[0],\n      forceUpdate = _useState14[1];\n\n  var localRef = useRef(undefined);\n  var ref = optionalRef ? optionalRef : localRef;\n  useLayoutEffect(function () {\n    return void forceUpdate(function (i) {\n      return !i;\n    });\n  }, []);\n  return ref;\n}\n\nfunction buildGraph(object) {\n  var data = {\n    nodes: {},\n    materials: {}\n  };\n\n  if (object) {\n    object.traverse(function (obj) {\n      if (obj.name) data.nodes[obj.name] = obj;\n      if (obj.material && !data.materials[obj.material.name]) data.materials[obj.material.name] = obj.material;\n    });\n  }\n\n  return data;\n}\n\nfunction useGraph(object) {\n  return useMemo(function () {\n    return buildGraph(object);\n  }, [object]);\n}\n\nfunction loadingFn(extensions, onProgress) {\n  return function (Proto, input) {\n    // Construct new loader and run extensions\n    var loader = new Proto();\n    if (extensions) extensions(loader); // Go through the urls and load them\n\n    var urlArray = Array.isArray(input) ? input : [input];\n    return Promise.all(urlArray.map(function (input) {\n      return new Promise(function (res, reject) {\n        return loader.load(input, function (data) {\n          if (data.scene) Object.assign(data, buildGraph(data.scene));\n          res(data);\n        }, onProgress, function (error) {\n          return reject(error.message);\n        });\n      });\n    }));\n  };\n}\n\nfunction useLoader(Proto, input, extensions, onProgress) {\n  // Use suspense to load async assets\n  var results = useAsset(loadingFn(extensions, onProgress), [Proto, input]); // Return the object/s\n\n  return Array.isArray(input) ? results : results[0];\n}\n\nuseLoader.preload = function (Proto, url, extensions) {\n  return useAsset.preload(loadingFn(extensions), Proto, url);\n};\n\nvar defaultStyles = {\n  position: 'relative',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\n\nfunction Content(_ref6) {\n  var children = _ref6.children,\n      setEvents = _ref6.setEvents,\n      container = _ref6.container,\n      renderer = _ref6.renderer,\n      effects = _ref6.effects,\n      props = _objectWithoutProperties(_ref6, _excluded6);\n\n  // Create renderer\n  var _useState15 = useState(renderer),\n      _useState16 = _slicedToArray(_useState15, 1),\n      gl = _useState16[0];\n\n  if (!gl) console.warn('No renderer created!'); // Mount and unmount management\n\n  useEffect(function () {\n    if (effects) effects(gl, container);\n  }, [container, effects, gl]); // Init canvas, fetch events, hand them back to the wrapping div\n\n  var events = useCanvas(_objectSpread(_objectSpread({}, props), {}, {\n    children: children,\n    gl: gl\n  }));\n  useEffect(function () {\n    setEvents(events);\n  }, [events, setEvents]);\n  return null;\n}\n\nvar ResizeContainer = /*#__PURE__*/React.memo(function ResizeContainer(props) {\n  var renderer = props.renderer,\n      effects = props.effects,\n      children = props.children,\n      vr = props.vr,\n      webgl1 = props.webgl1,\n      concurrent = props.concurrent,\n      shadowMap = props.shadowMap,\n      colorManagement = props.colorManagement,\n      orthographic = props.orthographic,\n      invalidateFrameloop = props.invalidateFrameloop,\n      updateDefaultCamera = props.updateDefaultCamera,\n      noEvents = props.noEvents,\n      gl = props.gl,\n      camera = props.camera,\n      raycaster = props.raycaster,\n      pixelRatio = props.pixelRatio,\n      onCreated = props.onCreated,\n      onPointerMissed = props.onPointerMissed,\n      preRender = props.preRender,\n      resize = props.resize,\n      style = props.style,\n      restSpread = _objectWithoutProperties(props, _excluded7);\n\n  var containerRef = useRef(); // onGotPointerCaptureLegacy is a fake event used by non-web targets to simulate poinzter capture\n\n  var _useState17 = useState({}),\n      _useState18 = _slicedToArray(_useState17, 2),\n      _useState18$ = _useState18[0],\n      onGotPointerCaptureLegacy = _useState18$.onGotPointerCaptureLegacy,\n      events = _objectWithoutProperties(_useState18$, _excluded8),\n      setEvents = _useState18[1];\n\n  var _useMeasure = useMeasure(_objectSpread({\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    }\n  }, resize)),\n      _useMeasure2 = _slicedToArray(_useMeasure, 3),\n      bind = _useMeasure2[0],\n      size = _useMeasure2[1],\n      forceResize = _useMeasure2[2]; // Flag view ready once it's been measured out\n\n\n  var readyFlag = useRef(false);\n  var ready = useMemo(function () {\n    return readyFlag.current = readyFlag.current || !!size.width && !!size.height;\n  }, [size]);\n  var state = useMemo(function () {\n    return {\n      size: size,\n      forceResize: forceResize,\n      setEvents: setEvents,\n      container: containerRef.current\n    };\n  }, [forceResize, size]); // Allow Gatsby, Next and other server side apps to run. Will output styles to reduce flickering.\n\n  if (typeof window === 'undefined') return /*#__PURE__*/React.createElement(\"div\", _extends({\n    style: _objectSpread(_objectSpread({}, defaultStyles), style)\n  }, restSpread), preRender); // Render the canvas into the dom\n\n  return /*#__PURE__*/React.createElement(\"div\", _extends({\n    ref: mergeRefs([bind, containerRef]),\n    style: _objectSpread(_objectSpread({}, defaultStyles), style)\n  }, events, restSpread), preRender, ready && /*#__PURE__*/React.createElement(Content, _extends({}, props, state)));\n});\nvar Canvas = /*#__PURE__*/React.memo(function Canvas(_ref7) {\n  var children = _ref7.children,\n      props = _objectWithoutProperties(_ref7, _excluded9);\n\n  var canvasRef = useRef();\n\n  var _renderer = props.webgl1 ? WebGL1Renderer : WebGLRenderer;\n\n  return /*#__PURE__*/React.createElement(ResizeContainer, _extends({}, props, {\n    renderer: function renderer() {\n      if (canvasRef.current) {\n        var params = _objectSpread({\n          antialias: true,\n          alpha: true\n        }, props.gl);\n\n        var temp = new _renderer(_objectSpread({\n          powerPreference: 'high-performance',\n          //stencil: false,\n          //depth: false,\n          canvas: canvasRef.current\n        }, params));\n        return temp;\n      }\n    },\n    preRender: /*#__PURE__*/React.createElement(\"canvas\", {\n      ref: canvasRef,\n      style: {\n        display: 'block'\n      }\n    })\n  }), children);\n});\nexport { Canvas, threeTypes as ReactThreeFiber, Renderer, ResizeContainer, addAfterEffect, addEffect, addTail, applyProps, createPortal, extend, forceResize, _invalidate as invalidate, isOrthographicCamera, render, renderGl, stateContext, unmountComponentAtNode, useCanvas, useFrame, useGraph, useLoader, useResource, useThree, useUpdate };","map":{"version":3,"names":["_extends","THREE","Layers","Color","Texture","sRGBEncoding","Vector2","Raycaster","Scene","OrthographicCamera","PerspectiveCamera","Clock","Vector3","PCFSoftShadowMap","ACESFilmicToneMapping","WebGL1Renderer","WebGLRenderer","Reconciler","unstable_now","unstable_runWithPriority","unstable_IdlePriority","React","createContext","useState","useRef","useCallback","useMemo","useLayoutEffect","useEffect","createElement","useContext","useContext$1","TinyEmitter","useAsset","useMeasure","mergeRefs","name","version","roots","Map","emptyObject","is","obj","a","Object","arr","fun","str","num","und","Array","isArray","equ","b","i","createSubs","callback","subs","index","length","push","splice","globalEffects","globalAfterEffects","globalTailEffects","addEffect","addAfterEffect","addTail","renderGl","state","timestamp","repeat","runGlobalEffects","delta","current","clock","getDelta","subscribers","ref","frames","Math","max","invalidateFrameloop","manual","gl","render","scene","camera","running","renderLoop","forEach","root","containerInfo","__state","active","ready","requestAnimationFrame","invalidate","vr","forceResize","catalogue","extend","objects","applyProps","instance","newProps","oldProps","accumulative","container","__container","sameProps","handlers","keys","startsWith","includes","leftOvers","toFilter","__instance","filteredProps","indexOf","undefined","filteredPropsEntries","entries","key","value","_instance$__container","_instance$__container2","target","split","reduce","acc","set","reverse","reverseEntries","isColorManagement","colorManagement","copy","constructor","convertSRGBToLinear","encoding","invalidateInstance","raycast","__handlers","__interaction","charAt","toLowerCase","substr","parent","updateInstance","onUpdate","createInstance","type","hostContext","internalInstanceHandle","args","props","toUpperCase","slice","dispose","object","__dispose","has","fn","node","return","stateNode","__objects","endsWith","attach","appendChild","parentInstance","child","isObject3D","add","attachArray","attachObject","insertBefore","beforeChild","dispatchEvent","restSiblings","children","filter","sibling","removeRecursive","array","clone","removeChild","remove","x","switchInstance","fiber","newInstance","alternate","Renderer","now","warnsIfNotActing","supportsMutation","isPrimaryRenderer","scheduleTimeout","setTimeout","cancelTimeout","clearTimeout","noTimeout","appendInitialChild","appendChildToContainer","removeChildFromContainer","insertInContainerBefore","commitUpdate","updatePayload","argsNew","restNew","argsOld","restOld","hasNewArgs","some","val","hideInstance","visible","unhideInstance","hideTextInstance","Error","getPublicInstance","getRootHostContext","getChildHostContext","createTextInstance","finalizeInitialChildren","commitMount","prepareUpdate","shouldDeprioritizeSubtree","prepareForCommit","preparePortalMount","resetAfterCommit","shouldSetTextContent","clearContainer","hasSymbol","Symbol","for","REACT_PORTAL_TYPE","element","get","newRoot","createContainer","concurrent","updateContainer","getPublicRootInstance","unmountComponentAtNode","delete","createPortal","implementation","$$typeof","injectIntoDevTools","bundleType","process","env","NODE_ENV","findHostInstanceByFiber","rendererPackageName","threeTypes","freeze","__proto__","isOrthographicCamera","def","makeId","event","eventObject","uuid","stateContext","useCanvas","orthographic","raycaster","size","pixelRatio","shadowMap","updateDefaultCamera","noEvents","onCreated","onPointerMissed","setReady","mouse","ray","computeOffsets","raycasterProps","defaultRaycaster","defaultScene","cam","position","z","lookAt","defaultCam","setDefaultCamera","aspect","viewport","initialClick","initialHits","pointer","captured","events","subscribe","priority","sort","_state$current","s","intersect","prepare","handlePointerMove","getCurrentViewport","width","height","distance","distanceTo","zoom","factor","fov","PI","h","tan","w","assign","left","right","top","bottom","updateProjectionMatrix","updateMatrixWorld","setSize","sharedState","setPixelRatio","min","window","devicePixelRatio","enabled","toneMapping","outputEncoding","hovered","temp","prepareRay","offsets","nativeEvent","offsetX","offsetY","setFromCamera","seen","Set","hits","eventsObjects","intersects","intersectObjects","item","id","calculateDistance","dx","dy","round","sqrt","handlePointerCancel","emit","from","values","data","find","pointerOut","pointerLeave","getIntersects","intersections","hit","handleIntersects","unprojectedPoint","y","unproject","releasePointerCapture","localState","stopped","setPointerCapture","raycastEvent","stopPropagation","cap","higher","currentTarget","sourceEvent","pointerOver","pointerEnter","hoveredItem","pointerMove","handlePointer","pointerMissed","map","onClick","onContextMenu","onDoubleClick","onWheel","onPointerDown","onPointerUp","onPointerLeave","e","onPointerMove","onGotPointerCaptureLegacy","onLostPointerCapture","Canvas","activate","result","then","Provider","xr","setAnimationLoop","t","console","warn","renderLists","forceContextLoss","_handlers$pointerMis","_handlers","call","p","context","useFrame","renderPriority","unsubscribe","useThree","useUpdate","dependents","optionalRef","localRef","useResource","_","forceUpdate","buildGraph","nodes","materials","traverse","material","useGraph","loadingFn","extensions","onProgress","Proto","input","loader","urlArray","Promise","all","res","reject","load","error","message","useLoader","results","preload","url","defaultStyles","overflow","Content","setEvents","renderer","effects","ResizeContainer","memo","webgl1","preRender","resize","style","restSpread","containerRef","scroll","debounce","bind","readyFlag","canvasRef","params","antialias","alpha","powerPreference","canvas","display","ReactThreeFiber"],"sources":["/Users/khuong/Downloads/avatar-homepage-demo-forked/node_modules/react-three-fiber/web.js"],"sourcesContent":["import _extends from '@babel/runtime/helpers/esm/extends';\nimport * as THREE from 'three';\nimport { Layers, Color, Texture, sRGBEncoding, Vector2, Raycaster, Scene, OrthographicCamera, PerspectiveCamera, Clock, Vector3, PCFSoftShadowMap, ACESFilmicToneMapping, WebGL1Renderer, WebGLRenderer } from 'three';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\nimport React, { createContext, useState, useRef, useCallback, useMemo, useLayoutEffect, useEffect, createElement, useContext as useContext$1 } from 'react';\nimport { TinyEmitter } from 'tiny-emitter';\nimport { useAsset } from 'use-asset';\nimport useMeasure from 'react-use-measure';\nimport mergeRefs from 'react-merge-refs';\n\nvar name = \"react-three-fiber\";\nvar version = \"5.3.7\";\n\nconst roots = new Map();\nconst emptyObject = {};\nconst is = {\n  obj: a => a === Object(a) && !is.arr(a),\n  fun: a => typeof a === 'function',\n  str: a => typeof a === 'string',\n  num: a => typeof a === 'number',\n  und: a => a === void 0,\n  arr: a => Array.isArray(a),\n\n  equ(a, b) {\n    // Wrong type or one of the two undefined, doesn't match\n    if (typeof a !== typeof b || !!a !== !!b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    let i;\n\n    for (i in a) if (!(i in b)) return false;\n\n    for (i in b) if (a[i] !== b[i]) return false;\n\n    return is.und(i) ? a === b : true;\n  }\n\n};\n\nfunction createSubs(callback, subs) {\n  const index = subs.length;\n  subs.push(callback);\n  return () => void subs.splice(index, 1);\n}\n\nlet globalEffects = [];\nlet globalAfterEffects = [];\nlet globalTailEffects = [];\nconst addEffect = callback => createSubs(callback, globalEffects);\nconst addAfterEffect = callback => createSubs(callback, globalAfterEffects);\nconst addTail = callback => createSubs(callback, globalTailEffects);\nfunction renderGl(state, timestamp, repeat = 0, runGlobalEffects = false) {\n  let i; // Run global effects\n\n  if (runGlobalEffects) {\n    for (i = 0; i < globalEffects.length; i++) {\n      globalEffects[i](timestamp);\n      repeat++;\n    }\n  } // Run local effects\n\n\n  const delta = state.current.clock.getDelta();\n\n  for (i = 0; i < state.current.subscribers.length; i++) {\n    state.current.subscribers[i].ref.current(state.current, delta);\n  } // Decrease frame count\n\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual && state.current.gl.render) state.current.gl.render(state.current.scene, state.current.camera); // Run global after-effects\n\n  if (runGlobalEffects) {\n    for (i = 0; i < globalAfterEffects.length; i++) {\n      globalAfterEffects[i](timestamp);\n    }\n  }\n\n  return repeat;\n}\nlet running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  let repeat = 0;\n  let i; // Run global effects\n\n  for (i = 0; i < globalEffects.length; i++) {\n    globalEffects[i](timestamp);\n    repeat++;\n  }\n\n  roots.forEach(root => {\n    const state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) {\n      repeat = renderGl(state, timestamp, repeat);\n    }\n  }); // Run global after-effects\n\n  for (i = 0; i < globalAfterEffects.length; i++) {\n    globalAfterEffects[i](timestamp);\n  }\n\n  if (repeat !== 0) {\n    return requestAnimationFrame(renderLoop);\n  } else {\n    // Tail call effects, they are called when rendering stops\n    for (i = 0; i < globalTailEffects.length; i++) {\n      globalTailEffects[i](timestamp);\n    }\n  } // Flag end of operation\n\n\n  running = false;\n}\n\nfunction invalidate(state = true, frames = 1) {\n  if (state === true) {\n    roots.forEach(root => {\n      const state = root.containerInfo.__state;\n      state.current.frames = state.current.ready ? state.current.frames + frames : frames;\n    });\n  } else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = state.current.ready ? state.current.frames + frames : frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\nfunction forceResize() {\n  roots.forEach(root => root.containerInfo.__state.current.forceResize());\n}\nlet catalogue = {};\nconst extend = objects => void (catalogue = { ...catalogue,\n  ...objects\n});\nfunction applyProps(instance, newProps, oldProps = {}, accumulative = false) {\n  // Filter equals, events and reserved props\n  const container = instance.__container;\n  const sameProps = [];\n  const handlers = [];\n  let i;\n  let keys = Object.keys(newProps);\n\n  for (i = 0; i < keys.length; i++) {\n    if (is.equ(newProps[keys[i]], oldProps[keys[i]])) {\n      sameProps.push(keys[i]);\n    } // Event-handlers ...\n    //   are functions, that\n    //   start with \"on\", and\n    //   contain the name \"Pointer\", \"Click\", \"ContextMenu\", or \"Wheel\"\n\n\n    if (is.fun(newProps[keys[i]]) && keys[i].startsWith('on')) {\n      if (keys[i].includes('Pointer') || keys[i].includes('Click') || keys[i].includes('ContextMenu') || keys[i].includes('Wheel')) {\n        handlers.push(keys[i]);\n      }\n    }\n  }\n\n  const leftOvers = [];\n  keys = Object.keys(oldProps);\n\n  if (accumulative) {\n    for (i = 0; i < keys.length; i++) {\n      if (newProps[keys[i]] === void 0) {\n        leftOvers.push(keys[i]);\n      }\n    }\n  }\n\n  const toFilter = [...sameProps, 'children', 'key', 'ref']; // Instances use \"object\" as a reserved identifier\n\n  if (instance.__instance) toFilter.push('object');\n  const filteredProps = { ...newProps\n  }; // Removes sameProps and reserved props from newProps\n\n  keys = Object.keys(filteredProps);\n\n  for (i = 0; i < keys.length; i++) {\n    if (toFilter.indexOf(keys[i]) > -1) {\n      delete filteredProps[keys[i]];\n    }\n  } // Add left-overs as undefined props so they can be removed\n\n\n  keys = Object.keys(leftOvers);\n\n  for (i = 0; i < keys.length; i++) {\n    if (keys[i] !== 'children') {\n      filteredProps[keys[i]] = undefined;\n    }\n  }\n\n  const filteredPropsEntries = Object.entries(filteredProps);\n\n  if (filteredPropsEntries.length > 0) {\n    filteredPropsEntries.forEach(([key, value]) => {\n      if (!handlers.includes(key)) {\n        var _instance$__container, _instance$__container2;\n\n        let root = instance;\n        let target = root[key];\n\n        if (key.includes('-')) {\n          const entries = key.split('-');\n          target = entries.reduce((acc, key) => acc[key], instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            const [name, ...reverseEntries] = entries.reverse();\n            root = reverseEntries.reverse().reduce((acc, key) => acc[key], instance);\n            key = name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        const isColorManagement = (_instance$__container = instance.__container) == null ? void 0 : (_instance$__container2 = _instance$__container.__state) == null ? void 0 : _instance$__container2.current.colorManagement;\n\n        if (target && target.set && (target.copy || target instanceof Layers)) {\n          // If value is an array it has got to be the set function\n          if (Array.isArray(value)) {\n            target.set(...value);\n          } // Test again target.copy(class) next ...\n          else if (target.copy && value && value.constructor && target.constructor.name === value.constructor.name) {\n              target.copy(value);\n            } // If nothing else fits, just set the single value, ignore undefined\n            // https://github.com/react-spring/react-three-fiber/issues/274\n            else if (value !== undefined) {\n                target.set(value); // Auto-convert sRGB colors, for now ...\n                // https://github.com/react-spring/react-three-fiber/issues/344\n\n                if (isColorManagement && target instanceof Color) {\n                  target.convertSRGBToLinear();\n                }\n              } // Else, just overwrite the value\n\n        } else {\n          root[key] = value; // Auto-convert sRGB textures, for now ...\n          // https://github.com/react-spring/react-three-fiber/issues/344\n\n          if (isColorManagement && root[key] instanceof Texture) {\n            root[key].encoding = sRGBEncoding;\n          }\n        }\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      const index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      if (accumulative && container && instance.raycast) container.__interaction.push(instance); // Add handlers to the instances handler-map\n\n      instance.__handlers = handlers.reduce((acc, key) => {\n        acc[key.charAt(2).toLowerCase() + key.substr(3)] = newProps[key];\n        return acc;\n      }, {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.onUpdate) instance.onUpdate(instance);\n}\n\nfunction createInstance(type, {\n  args = [],\n  ...props\n}, container, hostContext, internalInstanceHandle) {\n  let name = `${type[0].toUpperCase()}${type.slice(1)}`;\n  let instance;\n\n  if (type === 'primitive') {\n    // Switch off dispose for primitive objects\n    props = {\n      dispose: null,\n      ...props\n    };\n    instance = props.object;\n    instance.__instance = true;\n    instance.__dispose = instance.dispose;\n  } else {\n    const target = catalogue[name] || THREE[name];\n\n    if (!target) {\n      throw `\"${name}\" is not part of the THREE namespace! Did you forget to extend it? See: https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#using-3rd-party-objects-declaratively`;\n    }\n\n    instance = is.arr(args) ? new target(...args) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // TODO: https://github.com/facebook/react/issues/17147\n  // If it's still not there it means the portal was created on a virtual node outside of react\n\n\n  if (!roots.has(container)) {\n    const fn = node => {\n      if (!node.return) return node.stateNode && node.stateNode.containerInfo;else return fn(node.return);\n    };\n\n    container = fn(internalInstanceHandle);\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // Auto-attach geometries and materials\n\n  if (name.endsWith('Geometry')) {\n    props = {\n      attach: 'geometry',\n      ...props\n    };\n  } else if (name.endsWith('Material')) {\n    props = {\n      attach: 'material',\n      ...props\n    };\n  } // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"true\" here\n\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.add(child);\n    } else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      } else if (child.attach) {\n        parentInstance[child.attach] = child;\n      }\n    }\n\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      });\n      const restSiblings = parentInstance.children.filter(sibling => sibling !== child); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      const index = restSiblings.indexOf(beforeChild);\n      parentInstance.children = [...restSiblings.slice(0, index), child, ...restSiblings.slice(index)];\n      updateInstance(child);\n    } else {\n      appendChild(parentInstance, child);\n    } // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent, clone = false) {\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    const target = clone ? [...array] : array;\n    target.forEach(child => removeChild(parent, child));\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      if (parentInstance.__objects) parentInstance.__objects = parentInstance.__objects.filter(x => x !== child); // Remove attachment\n\n      if (child.attachArray) {\n        parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(x => x !== child);\n      } else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      } else if (child.attach) {\n        parentInstance[child.attach] = null;\n      }\n    } // Remove interactivity\n\n\n    if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(x => x !== child);\n    invalidateInstance(child); // Allow objects to bail out of recursive dispose alltogether by passing dispose={null}\n\n    if (child.dispose !== null) {\n      unstable_runWithPriority(unstable_IdlePriority, () => {\n        // Remove nested child objects\n        removeRecursive(child.__objects, child);\n        removeRecursive(child.children, child, true); // Dispose item\n\n        if (child.dispose && child.type !== 'Scene') child.dispose();else if (child.__dispose) child.__dispose(); // Remove references\n\n        delete child.__container;\n        delete child.__objects;\n      });\n    }\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  const parent = instance.parent;\n  const newInstance = createInstance(type, newProps, instance.__container, null, fiber);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(fiber => {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (is.fun(fiber.ref)) fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nconst Renderer = Reconciler({\n  now: unstable_now,\n  createInstance,\n  removeChild,\n  appendChild,\n  insertBefore,\n  warnsIfNotActing: true,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  scheduleTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  cancelTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  // @ts-ignore\n  setTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  // @ts-ignore\n  clearTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  noTimeout: -1,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n\n  commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else {\n      // This is a data object, let's extract critical information about it\n      const {\n        args: argsNew = [],\n        ...restNew\n      } = newProps;\n      const {\n        args: argsOld = [],\n        ...restOld\n      } = oldProps; // If it has new props or arguments, then it needs to be re-instanciated\n\n      const hasNewArgs = argsNew.some((value, index) => is.obj(value) ? Object.entries(value).some(([key, val]) => val !== argsOld[index][key]) : value !== argsOld[index]);\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n\n  hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n\n  unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n\n  hideTextInstance() {\n    throw new Error('Text is not allowed in the react-three-fibre tree. You may have extraneous whitespace between components.');\n  },\n\n  getPublicInstance(instance) {\n    return instance;\n  },\n\n  getRootHostContext() {\n    return emptyObject;\n  },\n\n  getChildHostContext() {\n    return emptyObject;\n  },\n\n  createTextInstance() {},\n\n  finalizeInitialChildren(instance) {\n    // https://github.com/facebook/react/issues/20271\n    // Returning true will trigger commitMount\n    return instance.__handlers;\n  },\n\n  commitMount(instance)\n  /*, type, props*/\n  {\n    // https://github.com/facebook/react/issues/20271\n    // This will make sure events are only added once to the central container\n    const container = instance.__container;\n    if (container && instance.raycast && instance.__handlers) container.__interaction.push(instance);\n  },\n\n  prepareUpdate() {\n    return emptyObject;\n  },\n\n  shouldDeprioritizeSubtree() {\n    return false;\n  },\n\n  prepareForCommit() {\n    return null;\n  },\n\n  preparePortalMount() {\n    return null;\n  },\n\n  resetAfterCommit() {},\n\n  shouldSetTextContent() {\n    return false;\n  },\n\n  clearContainer() {\n    return false;\n  }\n\n});\nconst hasSymbol = is.fun(Symbol) && Symbol.for;\nconst REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca;\nfunction render(element, container, state) {\n  let root = roots.get(container);\n\n  if (!root) {\n    container.__state = state; // @ts-ignore\n\n    let newRoot = root = Renderer.createContainer(container, state !== undefined && state.current.concurrent ? 2 : 0, false, // @ts-ignore\n    null);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, () => undefined);\n  return Renderer.getPublicRootInstance(root);\n}\nfunction unmountComponentAtNode(container, callback) {\n  const root = roots.get(container);\n\n  if (root) {\n    Renderer.updateContainer(null, root, null, () => {\n      roots.delete(container);\n      if (callback) callback(container);\n    });\n  }\n}\nfunction createPortal(children, containerInfo, implementation, key = null) {\n  if (!containerInfo.__objects) containerInfo.__objects = [];\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children,\n    containerInfo,\n    implementation\n  };\n}\nRenderer.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  //@ts-ignore\n  findHostInstanceByFiber: () => null,\n  version: version,\n  rendererPackageName: name\n});\n\nvar threeTypes = /*#__PURE__*/Object.freeze({\n  __proto__: null\n});\n\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index;\n}\n\nconst stateContext = /*#__PURE__*/createContext({});\nconst useCanvas = props => {\n  const {\n    children,\n    gl,\n    camera,\n    orthographic,\n    raycaster,\n    size,\n    pixelRatio,\n    vr = false,\n    concurrent = false,\n    shadowMap = false,\n    colorManagement = true,\n    invalidateFrameloop = false,\n    updateDefaultCamera = true,\n    noEvents = false,\n    onCreated,\n    onPointerMissed,\n    forceResize\n  } = props; // Local, reactive state\n\n  const [ready, setReady] = useState(false);\n  const [mouse] = useState(() => new Vector2());\n  const [defaultRaycaster] = useState(() => {\n    const ray = new Raycaster();\n\n    if (raycaster) {\n      const {\n        filter,\n        computeOffsets,\n        ...raycasterProps\n      } = raycaster;\n      applyProps(ray, raycasterProps, {});\n    }\n\n    return ray;\n  });\n  const [defaultScene] = useState(() => {\n    const scene = new Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  });\n  const [defaultCam, setDefaultCamera] = useState(() => {\n    const cam = orthographic ? new OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {}); // Always look at [0, 0, 0]\n\n    cam.lookAt(0, 0, 0);\n    return cam;\n  });\n  const [clock] = useState(() => new Clock()); // Public state\n\n  const state = useRef({\n    ready: false,\n    active: true,\n    manual: 0,\n    colorManagement,\n    vr,\n    concurrent,\n    noEvents,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse,\n    clock,\n    gl,\n    size,\n    viewport: null,\n    initialClick: [0, 0],\n    initialHits: [],\n    pointer: new TinyEmitter(),\n    captured: undefined,\n    events: undefined,\n    subscribe: (ref, priority = 0) => {\n      // If this subscription was given a priority, it takes rendering into its own hands\n      // For that reason we switch off automatic rendering and increase the manual flag\n      // As long as this flag is positive (there could be multiple render subscription)\n      // ..there can be no internal rendering at all\n      if (priority) state.current.manual++;\n      state.current.subscribers.push({\n        ref,\n        priority: priority\n      }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n      state.current.subscribers = state.current.subscribers.sort((a, b) => a.priority - b.priority);\n      return () => {\n        var _state$current;\n\n        if ((_state$current = state.current) != null && _state$current.subscribers) {\n          // Decrease manual flag if this subscription had a priority\n          if (priority) state.current.manual--;\n          state.current.subscribers = state.current.subscribers.filter(s => s.ref !== ref);\n        }\n      };\n    },\n    setDefaultCamera: camera => setDefaultCamera(camera),\n    invalidate: () => invalidate(state),\n    intersect: (event = {}, prepare = true) => handlePointerMove(event, prepare),\n    forceResize\n  });\n  const getCurrentViewport = useCallback((camera = state.current.camera, target = new Vector3(0, 0, 0)) => {\n    const {\n      width,\n      height\n    } = state.current.size;\n    const distance = camera.position.distanceTo(target);\n\n    if (isOrthographicCamera(camera)) {\n      return {\n        width: width / camera.zoom,\n        height: height / camera.zoom,\n        factor: 1,\n        distance\n      };\n    } else {\n      const fov = camera.fov * Math.PI / 180; // convert vertical fov to radians\n\n      const h = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      const w = h * (width / height);\n      return {\n        width: w,\n        height: h,\n        factor: width / w,\n        distance\n      };\n    }\n  }, []); // Writes locals into public state for distribution among subscribers, context, etc\n\n  useMemo(() => {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.gl = gl;\n    state.current.concurrent = concurrent;\n    state.current.noEvents = noEvents; // Make viewport backwards compatible\n\n    state.current.viewport = getCurrentViewport; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [invalidateFrameloop, vr, concurrent, noEvents, ready, size, defaultCam, gl]); // Adjusts default camera\n\n  useMemo(() => {\n    state.current.aspect = size.width / size.height; // Assign viewport props to the function\n\n    Object.assign(state.current.viewport, getCurrentViewport()); // https://github.com/drcmda/react-three-fiber/issues/92\n    // Sometimes automatic default camera adjustment isn't wanted behaviour\n\n    if (updateDefaultCamera) {\n      if (isOrthographicCamera(defaultCam)) {\n        defaultCam.left = size.width / -2;\n        defaultCam.right = size.width / 2;\n        defaultCam.top = size.height / 2;\n        defaultCam.bottom = size.height / -2;\n      } else {\n        defaultCam.aspect = state.current.aspect;\n      }\n\n      defaultCam.updateProjectionMatrix(); // https://github.com/react-spring/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      defaultCam.updateMatrixWorld();\n    }\n\n    gl.setSize(size.width, size.height);\n    if (ready) invalidate(state); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [defaultCam, gl, size, updateDefaultCamera, ready]); // Only trigger the context provider when necessary\n\n  const sharedState = useRef(null);\n  useMemo(() => {\n    const {\n      ready,\n      manual,\n      vr,\n      noEvents,\n      invalidateFrameloop,\n      frames,\n      subscribers,\n      captured,\n      initialClick,\n      initialHits,\n      ...props\n    } = state.current;\n    sharedState.current = props; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [size, defaultCam]); // Update pixel ratio\n\n  useLayoutEffect(() => {\n    if (pixelRatio) {\n      if (Array.isArray(pixelRatio)) gl.setPixelRatio(Math.max(Math.min(pixelRatio[0], window.devicePixelRatio), pixelRatio[1]));else gl.setPixelRatio(pixelRatio);\n    }\n  }, [gl, pixelRatio]); // Update shadow map\n\n  useLayoutEffect(() => {\n    if (shadowMap) {\n      gl.shadowMap.enabled = true;\n      if (typeof shadowMap === 'object') Object.assign(gl.shadowMap, shadowMap);else gl.shadowMap.type = PCFSoftShadowMap;\n    }\n\n    if (colorManagement) {\n      gl.toneMapping = ACESFilmicToneMapping;\n      gl.outputEncoding = sRGBEncoding;\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [shadowMap, colorManagement]);\n  /** Events ------------------------------------------------------------------------------------------------ */\n\n  const hovered = useMemo(() => new Map(), []);\n  const temp = new Vector3();\n  /** Sets up defaultRaycaster */\n\n  const prepareRay = useCallback(event => {\n    // https://github.com/pmndrs/react-three-fiber/pull/782\n    // Events trigger outside of canvas when moved\n    const offsets = (raycaster == null ? void 0 : raycaster.computeOffsets == null ? void 0 : raycaster.computeOffsets(event, sharedState.current)) || event.nativeEvent;\n\n    if (offsets) {\n      const {\n        offsetX,\n        offsetY\n      } = offsets;\n      const {\n        width,\n        height\n      } = state.current.size;\n      mouse.set(offsetX / width * 2 - 1, -(offsetY / height) * 2 + 1);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  const intersect = useCallback((event, filter) => {\n    // Skip event handling when noEvents is set\n    if (state.current.noEvents) return [];\n    const seen = new Set();\n    const hits = []; // Allow callers to eliminate event objects\n\n    const eventsObjects = filter ? filter(state.current.scene.__interaction) : state.current.scene.__interaction; // Intersect known handler objects and filter against duplicates\n\n    let intersects = defaultRaycaster.intersectObjects(eventsObjects, true).filter(item => {\n      const id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // https://github.com/mrdoob/three.js/issues/16031\n    // Allow custom userland intersect sort order\n\n    if (raycaster && raycaster.filter && sharedState.current) {\n      intersects = raycaster.filter(intersects, sharedState.current);\n    }\n\n    for (const intersect of intersects) {\n      let eventObject = intersect.object; // Bubble event up\n\n      while (eventObject) {\n        const handlers = eventObject.__handlers;\n        if (handlers) hits.push({ ...intersect,\n          eventObject\n        });\n        eventObject = eventObject.parent;\n      }\n    }\n\n    return hits;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  /**  Calculates click deltas */\n\n  const calculateDistance = useCallback(event => {\n    const dx = event.nativeEvent.offsetX - state.current.initialClick[0];\n    const dy = event.nativeEvent.offsetY - state.current.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }, []);\n  const handlePointerCancel = useCallback((event, hits, prepare = true) => {\n    state.current.pointer.emit('pointerCancel', event);\n    if (prepare) prepareRay(event);\n    Array.from(hovered.values()).forEach(data => {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (hits && (!hits.length || !hits.find(i => i.eventObject === data.eventObject && i.index === data.index))) {\n        const eventObject = data.eventObject;\n        const handlers = eventObject.__handlers;\n        hovered.delete(makeId(data));\n\n        if (handlers) {\n          if (handlers.pointerOut) handlers.pointerOut({ ...data,\n            type: 'pointerout'\n          });\n          if (handlers.pointerLeave) handlers.pointerLeave({ ...data,\n            type: 'pointerleave'\n          });\n        }\n      }\n    }); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  /**  Creates filtered intersects and returns an array of positive hits */\n\n  const getIntersects = useCallback((event, filter) => {\n    // Get fresh intersects\n    const intersections = intersect(event, filter); // If the interaction is captured take that into account, the captured event has to be part of the intersects\n\n    if (state.current.captured && event.type !== 'click' && event.type !== 'wheel') {\n      state.current.captured.forEach(captured => {\n        if (!intersections.find(hit => hit.eventObject === captured.eventObject)) intersections.push(captured);\n      });\n    }\n\n    return intersections;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  const handleIntersects = useCallback((intersections, event, fn) => {\n    // If anything has been found, forward it to the event listeners\n    if (intersections.length) {\n      const unprojectedPoint = temp.set(mouse.x, mouse.y, 0).unproject(state.current.camera);\n      const delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n      const releasePointerCapture = id => event.target.releasePointerCapture(id);\n\n      const localState = {\n        stopped: false,\n        captured: false\n      };\n\n      for (const hit of intersections) {\n        const setPointerCapture = id => {\n          // If the hit is going to be captured flag that we're in captured state\n          if (!localState.captured) {\n            localState.captured = true; // The captured hit array is reset to collect hits\n\n            state.current.captured = [];\n          } // Push hits to the array\n\n\n          if (state.current.captured) {\n            state.current.captured.push(hit);\n          } // Call the original event now\n          event.target.setPointerCapture(id);\n        };\n\n        const raycastEvent = { ...event,\n          ...hit,\n          intersections,\n          stopped: localState.stopped,\n          delta,\n          unprojectedPoint,\n          ray: defaultRaycaster.ray,\n          camera: state.current.camera,\n          // Hijack stopPropagation, which just sets a flag\n          stopPropagation: () => {\n            // https://github.com/react-spring/react-three-fiber/issues/596\n            // Events are not allowed to stop propagation if the pointer has been captured\n            const cap = state.current.captured;\n\n            if (!cap || cap.find(h => h.eventObject.id === hit.eventObject.id)) {\n              raycastEvent.stopped = localState.stopped = true; // Propagation is stopped, remove all other hover records\n              // An event handler is only allowed to flush other handlers if it is hovered itself\n\n              if (hovered.size && Array.from(hovered.values()).find(i => i.object === hit.object)) {\n                // Objects cannot flush out higher up objects that have already caught the event\n                const higher = intersections.slice(0, intersections.indexOf(hit));\n                handlePointerCancel(raycastEvent, [...higher, hit]);\n              }\n            }\n          },\n          target: { ...event.target,\n            setPointerCapture,\n            releasePointerCapture\n          },\n          currentTarget: { ...event.currentTarget,\n            setPointerCapture,\n            releasePointerCapture\n          },\n          sourceEvent: event\n        };\n        fn(raycastEvent); // Event bubbling may be interrupted by stopPropagation\n\n        if (localState.stopped === true) break;\n      }\n    }\n\n    return intersections;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  const handlePointerMove = useCallback((event, prepare = true) => {\n    state.current.pointer.emit('pointerMove', event);\n    if (prepare) prepareRay(event);\n    const hits = getIntersects(event, // This is onPointerMove, we're only interested in events that exhibit this particular event\n    objects => objects.filter(obj => ['Move', 'Over', 'Enter', 'Out', 'Leave'].some(name => obj.__handlers['pointer' + name]))); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    handleIntersects(hits, event, data => {\n      const eventObject = data.eventObject;\n      const handlers = eventObject.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerEnter || handlers.pointerOut || handlers.pointerLeave) {\n        const id = makeId(data);\n        const hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver({ ...data,\n            type: 'pointerover'\n          });\n          if (handlers.pointerEnter) handlers.pointerEnter({ ...data,\n            type: 'pointerenter'\n          });\n        } else if (hoveredItem.stopped) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation();\n        }\n      } // Call mouse move\n\n\n      if (handlers.pointerMove) handlers.pointerMove(data);\n    });\n    return hits; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  const handlePointer = useCallback(name => (event, prepare = true) => {\n    state.current.pointer.emit(name, event);\n    if (prepare) prepareRay(event);\n    const hits = getIntersects(event);\n    handleIntersects(hits, event, data => {\n      const eventObject = data.eventObject;\n      const handlers = eventObject.__handlers;\n\n      if (handlers && handlers[name]) {\n        // Forward all events back to their respective handlers with the exception of click events,\n        // which must use the initial target\n        if (name !== 'click' && name !== 'contextMenu' && name !== 'doubleClick' || state.current.initialHits.includes(eventObject)) {\n          handlers[name](data);\n          pointerMissed(event, defaultScene.__interaction, object => object !== eventObject);\n        }\n      }\n    }); // If a click yields no results, pass it back to the user as a miss\n\n    if (name === 'pointerDown') {\n      state.current.initialClick = [event.nativeEvent.offsetX, event.nativeEvent.offsetY];\n      state.current.initialHits = hits.map(hit => hit.eventObject);\n    }\n\n    if ((name === 'click' || name === 'contextMenu' || name === 'doubleClick') && !hits.length) {\n      if (calculateDistance(event) <= 2) {\n        pointerMissed(event, defaultScene.__interaction);\n        if (onPointerMissed) onPointerMissed();\n      }\n    }\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  [onPointerMissed, calculateDistance, getIntersects, handleIntersects, prepareRay]);\n  useMemo(() => {\n    state.current.events = {\n      onClick: handlePointer('click'),\n      onContextMenu: handlePointer('contextMenu'),\n      onDoubleClick: handlePointer('doubleClick'),\n      onWheel: handlePointer('wheel'),\n      onPointerDown: handlePointer('pointerDown'),\n      onPointerUp: handlePointer('pointerUp'),\n      onPointerLeave: e => handlePointerCancel(e, []),\n      onPointerMove: handlePointerMove,\n      // onGotPointerCapture is not needed any longer because the behaviour is hacked into\n      // the event itself (see handleIntersects). But in order for non-web targets to simulate\n      // it we keep the legacy event, which simply flags all current intersects as captured\n      onGotPointerCaptureLegacy: e => state.current.captured = intersect(e),\n      onLostPointerCapture: e => (state.current.captured = undefined, handlePointerCancel(e))\n    };\n  }, [handlePointer, intersect, handlePointerCancel, handlePointerMove]);\n  /** Events ------------------------------------------------------------------------------------------------- */\n  // This component is a bridge into the three render context, when it gets rendered\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  const Canvas = useCallback(function Canvas(props) {\n    const activate = () => setReady(true);\n\n    useEffect(() => {\n      const result = onCreated && onCreated(state.current);\n      if (result && result.then) result.then(activate);else activate();\n    }, []);\n    return props.children;\n  }, // The Canvas component has to be static, it should not be re-created ever\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  []); // Render v-dom into scene\n\n  useLayoutEffect(() => {\n    render( /*#__PURE__*/createElement(Canvas, null, /*#__PURE__*/createElement(stateContext.Provider, {\n      value: sharedState.current\n    }, typeof children === 'function' ? children(state.current) : children)), defaultScene, state); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [ready, children, sharedState.current]);\n  useLayoutEffect(() => {\n    if (ready) {\n      // Start render-loop, either via RAF or setAnimationLoop for VR\n      if (!state.current.vr) {\n        if (state.current.frames === 0) invalidate(state);\n      } else if ((gl.xr || gl.vr) && gl.setAnimationLoop) {\n        (gl.xr || gl.vr).enabled = true;\n        gl.setAnimationLoop(t => renderGl(state, t, 0, true));\n      } else {\n        console.warn('the gl instance does not support VR!');\n      }\n    }\n  }, [gl, ready, invalidateFrameloop]); // Dispose renderer on unmount\n\n  useEffect(() => () => {\n    if (state.current.gl) {\n      if (state.current.gl.renderLists) state.current.gl.renderLists.dispose();\n      if (state.current.gl.forceContextLoss) state.current.gl.forceContextLoss();\n      dispose(state.current.gl);\n    }\n\n    unmountComponentAtNode(state.current.scene, () => {\n      dispose(state.current.raycaster);\n      dispose(state.current.camera);\n      dispose(state.current);\n    });\n  }, []);\n  return state.current.events;\n};\n\nfunction pointerMissed(event, objects, filter = object => true) {\n  objects.filter(filter).forEach(object => {\n    var _handlers$pointerMis, _handlers;\n\n    return (_handlers$pointerMis = (_handlers = object.__handlers).pointerMissed) == null ? void 0 : _handlers$pointerMis.call(_handlers, event);\n  });\n}\n\nfunction dispose(obj) {\n  if (obj.dispose && obj.type !== 'Scene') obj.dispose();\n\n  for (const p in obj) {\n    if (typeof p === 'object' && p.dispose) p.dispose();\n    delete obj[p];\n  }\n}\n\nfunction useContext(context) {\n  let result = useContext$1(context);\n\n  if (!('subscribe' in result)) {\n    throw new Error(` react-three-fiber hooks can only be used within the Canvas component! https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#hooks`);\n  }\n\n  return result;\n}\n\nfunction useFrame(callback, renderPriority = 0) {\n  const {\n    subscribe\n  } = useContext(stateContext); // Update ref\n\n  const ref = useRef(callback);\n  useLayoutEffect(() => void (ref.current = callback), [callback]); // Subscribe/unsub\n\n  useEffect(() => {\n    const unsubscribe = subscribe(ref, renderPriority);\n    return () => unsubscribe();\n  }, [renderPriority, subscribe]);\n  return null;\n}\nfunction useThree() {\n  return useContext(stateContext);\n}\nfunction useUpdate(callback, dependents, optionalRef) {\n  const {\n    invalidate\n  } = useContext(stateContext);\n  const localRef = useRef();\n  const ref = optionalRef ? optionalRef : localRef;\n  useLayoutEffect(() => {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents); // eslint-disable-line react-hooks/exhaustive-deps\n\n  return ref;\n}\nfunction useResource(optionalRef) {\n  const [_, forceUpdate] = useState(false);\n  const localRef = useRef(undefined);\n  const ref = optionalRef ? optionalRef : localRef;\n  useLayoutEffect(() => void forceUpdate(i => !i), []);\n  return ref;\n}\n\nfunction buildGraph(object) {\n  const data = {\n    nodes: {},\n    materials: {}\n  };\n\n  if (object) {\n    object.traverse(obj => {\n      if (obj.name) data.nodes[obj.name] = obj;\n      if (obj.material && !data.materials[obj.material.name]) data.materials[obj.material.name] = obj.material;\n    });\n  }\n\n  return data;\n}\n\nfunction useGraph(object) {\n  return useMemo(() => buildGraph(object), [object]);\n}\n\nfunction loadingFn(extensions, onProgress) {\n  return function (Proto, input) {\n    // Construct new loader and run extensions\n    const loader = new Proto();\n    if (extensions) extensions(loader); // Go through the urls and load them\n\n    const urlArray = Array.isArray(input) ? input : [input];\n    return Promise.all(urlArray.map(input => new Promise((res, reject) => loader.load(input, data => {\n      if (data.scene) Object.assign(data, buildGraph(data.scene));\n      res(data);\n    }, onProgress, error => reject(error.message)))));\n  };\n}\n\nfunction useLoader(Proto, input, extensions, onProgress) {\n  // Use suspense to load async assets\n  const results = useAsset(loadingFn(extensions, onProgress), [Proto, input]); // Return the object/s\n\n  return Array.isArray(input) ? results : results[0];\n}\n\nuseLoader.preload = function (Proto, url, extensions) {\n  return useAsset.preload(loadingFn(extensions), Proto, url);\n};\n\nconst defaultStyles = {\n  position: 'relative',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\n\nfunction Content({\n  children,\n  setEvents,\n  container,\n  renderer,\n  effects,\n  ...props\n}) {\n  // Create renderer\n  const [gl] = useState(renderer);\n  if (!gl) console.warn('No renderer created!'); // Mount and unmount management\n\n  useEffect(() => {\n    if (effects) effects(gl, container);\n  }, [container, effects, gl]); // Init canvas, fetch events, hand them back to the wrapping div\n\n  const events = useCanvas({ ...props,\n    children,\n    gl: gl\n  });\n  useEffect(() => {\n    setEvents(events);\n  }, [events, setEvents]);\n  return null;\n}\n\nconst ResizeContainer = /*#__PURE__*/React.memo(function ResizeContainer(props) {\n  const {\n    renderer,\n    effects,\n    children,\n    vr,\n    webgl1,\n    concurrent,\n    shadowMap,\n    colorManagement,\n    orthographic,\n    invalidateFrameloop,\n    updateDefaultCamera,\n    noEvents,\n    gl,\n    camera,\n    raycaster,\n    pixelRatio,\n    onCreated,\n    onPointerMissed,\n    preRender,\n    resize,\n    style,\n    ...restSpread\n  } = props;\n  const containerRef = useRef(); // onGotPointerCaptureLegacy is a fake event used by non-web targets to simulate poinzter capture\n\n  const [{\n    onGotPointerCaptureLegacy,\n    ...events\n  }, setEvents] = useState({});\n  const [bind, size, forceResize] = useMeasure({\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    },\n    ...resize\n  }); // Flag view ready once it's been measured out\n\n  const readyFlag = useRef(false);\n  const ready = useMemo(() => readyFlag.current = readyFlag.current || !!size.width && !!size.height, [size]);\n  const state = useMemo(() => ({\n    size,\n    forceResize,\n    setEvents,\n    container: containerRef.current\n  }), [forceResize, size]); // Allow Gatsby, Next and other server side apps to run. Will output styles to reduce flickering.\n\n  if (typeof window === 'undefined') return /*#__PURE__*/React.createElement(\"div\", _extends({\n    style: { ...defaultStyles,\n      ...style\n    }\n  }, restSpread), preRender); // Render the canvas into the dom\n\n  return /*#__PURE__*/React.createElement(\"div\", _extends({\n    ref: mergeRefs([bind, containerRef]),\n    style: { ...defaultStyles,\n      ...style\n    }\n  }, events, restSpread), preRender, ready && /*#__PURE__*/React.createElement(Content, _extends({}, props, state)));\n});\n\nconst Canvas = /*#__PURE__*/React.memo(function Canvas({\n  children,\n  ...props\n}) {\n  const canvasRef = useRef();\n  const renderer = props.webgl1 ? WebGL1Renderer : WebGLRenderer;\n  return /*#__PURE__*/React.createElement(ResizeContainer, _extends({}, props, {\n    renderer: () => {\n      if (canvasRef.current) {\n        const params = {\n          antialias: true,\n          alpha: true,\n          ...props.gl\n        };\n        const temp = new renderer({\n          powerPreference: 'high-performance',\n          //stencil: false,\n          //depth: false,\n          canvas: canvasRef.current,\n          ...params\n        });\n        return temp;\n      }\n    },\n    preRender: /*#__PURE__*/React.createElement(\"canvas\", {\n      ref: canvasRef,\n      style: {\n        display: 'block'\n      }\n    })\n  }), children);\n});\n\nexport { Canvas, threeTypes as ReactThreeFiber, Renderer, ResizeContainer, addAfterEffect, addEffect, addTail, applyProps, createPortal, extend, forceResize, invalidate, isOrthographicCamera, render, renderGl, stateContext, unmountComponentAtNode, useCanvas, useFrame, useGraph, useLoader, useResource, useThree, useUpdate };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}